<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>arvin&#39;s blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-07-13T03:19:24.600Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>arvin</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>vim正则操作</title>
    <link href="http://yoursite.com/2019/07/13/vim%E6%AD%A3%E5%88%99%E6%93%8D%E4%BD%9C/"/>
    <id>http://yoursite.com/2019/07/13/vim正则操作/</id>
    <published>2019-07-13T03:18:28.000Z</published>
    <updated>2019-07-13T03:19:24.600Z</updated>
    
    <content type="html"><![CDATA[<h1 id="vim-快捷记录"><a href="#vim-快捷记录" class="headerlink" title="vim 快捷记录"></a>vim 快捷记录</h1><ol><li><p>行首添加#、tab等字符<br><code>:%s/^/#/</code><br><code>:%s/^/TAB/</code>           每一行的行首添加一个TAB字符<br><code>:2,50 s/^/\/\//g</code> 在2~50行首添加//号注释<br><code>:2,50 s/^\/\///g</code>  在2~50行首删除//号  </p></li><li><p>删除空行<br><code>:g/^$/d</code>  </p></li><li><p>删除空行以及只有空格的行<br><code>:g/^\s*$/d</code>  </p></li></ol><a id="more"></a><ol><li><p>删除以 # 开头或 空格# 或 tab#开头的行<br><code>:g/^\s*#/d</code><br><code>:g/^\s*;/d</code>   对于 php.ini 配置文件，注释为 ; 开头  </p></li><li><p>使用正则表达式删除行<br>如果当前行包含 bbs ，则删除当前行<br><code>:/bbs/d</code>  </p></li><li><p>删除从第二行到包含 bbs 的区间行<br><code>:2,/bbs/d</code>  </p></li><li><p>删除从包含 bbs 的行到最后一行区间的行<br><code>:/bbs/,$d</code>  </p></li><li><p>删除所有包含 bbs 的行<br><code>:g/bbs/d</code>  </p></li><li><p>删除匹配 bbs 且前面只有一个字符的行<br><code>:g/.bbs/d</code>  </p></li><li><p>删除匹配 bbs 且以它开头的行<br><code>:g/^bbs/d</code>  </p></li><li><p>删除匹配 bbs 且以它结尾的行<br><code>:g/bbs$/d</code>  </p></li><li><p>.ini 的注释是以 ; 开始的，如果注释不在行开头，那么删除 ; 及以后的字符<br><code>:%s/\;.\+//g</code>  </p></li><li><p>删除 # 之后所有字符<br><code>:%s/\#.*//g</code>  </p></li><li><p><strong>在匹配行后添加文字</strong></p><blockquote><p>:g/pattern 表示正则匹配，然后 s 表示替换，$ 表示替换对象  </p></blockquote></li></ol><p><code>:g/pattern/s/$/mytext</code></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;vim-快捷记录&quot;&gt;&lt;a href=&quot;#vim-快捷记录&quot; class=&quot;headerlink&quot; title=&quot;vim 快捷记录&quot;&gt;&lt;/a&gt;vim 快捷记录&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;行首添加#、tab等字符&lt;br&gt;&lt;code&gt;:%s/^/#/&lt;/code&gt;&lt;br&gt;&lt;code&gt;:%s/^/TAB/&lt;/code&gt;           每一行的行首添加一个TAB字符&lt;br&gt;&lt;code&gt;:2,50 s/^/\/\//g&lt;/code&gt; 在2~50行首添加//号注释&lt;br&gt;&lt;code&gt;:2,50 s/^\/\///g&lt;/code&gt;  在2~50行首删除//号  &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;删除空行&lt;br&gt;&lt;code&gt;:g/^$/d&lt;/code&gt;  &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;删除空行以及只有空格的行&lt;br&gt;&lt;code&gt;:g/^\s*$/d&lt;/code&gt;  &lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="编程" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="vim" scheme="http://yoursite.com/tags/vim/"/>
    
  </entry>
  
  <entry>
    <title>开发环境配置</title>
    <link href="http://yoursite.com/2019/04/08/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"/>
    <id>http://yoursite.com/2019/04/08/开发环境配置/</id>
    <published>2019-04-08T05:38:49.000Z</published>
    <updated>2019-08-02T09:31:31.252Z</updated>
    
    <content type="html"><![CDATA[<h2 id="软件篇"><a href="#软件篇" class="headerlink" title="软件篇"></a>软件篇</h2><h3 id="开发工具类"><a href="#开发工具类" class="headerlink" title="开发工具类"></a>开发工具类</h3><ul><li><a href="https://oneinstack.com/" target="_blank" rel="noopener">Oneinstack</a></li><li>Git</li><li>Phpstorm<ul><li><a href="https://github.com/839891627/phpstorm-config" target="_blank" rel="noopener">ideavim 配置</a></li><li>登录 phpstorm <code>Settings Repository</code></li><li><a href="#ideavimrc">.ideavimrc</a></li></ul></li><li>Postman<a id="more"></a>   </li><li>Navicat</li><li>Chrome</li><li>iTerm2</li><li>Tower</li><li>Charles<blockquote><p>适用于Charles任意版本的注册码，谁还会想要使用破解版呢。<br>  Charles 4.2目前是最新版，可用。<br>  Registered Name:     <a href="https://zhile.io" target="_blank" rel="noopener">https://zhile.io</a><br>  License Key:         48891cf209c6d32bf4  </p></blockquote></li><li>Rdm<blockquote><p>redis 图形管理界面</p></blockquote></li><li>Nodejs    </li><li>Composer<blockquote><p>中国镜像设置：<code>composer config -g repo.packagist composer https://packagist.phpcomposer.com</code></p></blockquote></li></ul><h3 id="效率工具类"><a href="#效率工具类" class="headerlink" title="效率工具类"></a>效率工具类</h3><ul><li>Magnet<blockquote><p>App store 安装，分屏工具</p></blockquote></li><li><a href="https://github.com/Cenmrev/V2RayX/releases" target="_blank" rel="noopener">V2RayX</a>    </li><li><a href="https://github.com/shadowsocks/ShadowsocksX-NG/releases" target="_blank" rel="noopener">ShadowsocksX-NG</a> </li><li>LastPass</li><li>Dash<blockquote><p>激活文件：<a href="https://pan.baidu.com/s/1Vt8J_KyAo2oL8jdqVLXJSQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1Vt8J_KyAo2oL8jdqVLXJSQ</a></p></blockquote></li><li>Typora<blockquote><p>markdown 编辑神器</p></blockquote></li><li>iPic<blockquote><p>图床工具，配合 <em>Typora</em> 使用    </p></blockquote></li><li>WPS</li><li><a href="https://note.youdao.com/web/" target="_blank" rel="noopener">有道云笔记</a></li><li>Airmail</li><li><a href="https://www.jianguoyun.com/" target="_blank" rel="noopener">坚果云</a></li><li><a href="https://gridea.dev/" target="_blank" rel="noopener">Gridea</a><blockquote><p>静态博客协作工具</p></blockquote></li><li>Paste</li><li>Xnip</li><li>BetterZip</li><li>Afred</li><li>Bartender 3 </li></ul><h3 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h3><h4 id="ideavimrc"><a href="#ideavimrc" class="headerlink" title="ideavimrc"></a>ideavimrc</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">set surround</span><br><span class="line">set encoding=utf-8</span><br><span class="line">set nu</span><br><span class="line">set relativenumber</span><br><span class="line">set incsearch</span><br><span class="line">set ignorecase</span><br><span class="line">" set ic</span><br><span class="line">set hlsearch</span><br><span class="line">set nowrapscan</span><br><span class="line">set showmatch</span><br><span class="line">nnoremap 0 ^</span><br><span class="line">nnoremap ,z :wq&lt;CR&gt;</span><br><span class="line">nnoremap &lt;esc&gt; :nohl&lt;cr&gt;</span><br><span class="line">nnoremap &lt;esc&gt; :nohls&lt;cr&gt;</span><br><span class="line">inoremap zz &lt;esc&gt;zz</span><br><span class="line">inoremap jk &lt;esc&gt;</span><br><span class="line">nnoremap Y yg_</span><br><span class="line">inoremap &lt;C-j&gt; &lt;Down&gt;</span><br><span class="line">inoremap &lt;C-k&gt; &lt;Up&gt;</span><br><span class="line"></span><br><span class="line">" 将当前行上下移</span><br><span class="line">noremap &lt;C-j&gt; :m .+1&lt;CR&gt;</span><br><span class="line">noremap &lt;C-k&gt; :m .-2&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">nnoremap zh :action PreviousTab&lt;CR&gt;</span><br><span class="line">nnoremap zl :action NextTab&lt;CR&gt;</span><br><span class="line">nnoremap ,q :action CloseAllEditors&lt;CR&gt;</span><br><span class="line">nnoremap &lt;tab&gt; :action NextSplitter&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">nnoremap &lt;C-O&gt; :action Back&lt;CR&gt;</span><br><span class="line">nnoremap &lt;C-I&gt; :action Forward&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">nnoremap &lt;space&gt;s &lt;ESC&gt;:source ~/.ideavimrc&lt;CR&gt;</span><br><span class="line">nnoremap &lt;space&gt;i &lt;ESC&gt;:e ~/.ideavimrc&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">nnoremap &lt;space&gt;u :action FindUsages&lt;CR&gt;</span><br><span class="line">nnoremap &lt;space&gt;f :action FileStructurePopup&lt;CR&gt;</span><br><span class="line">nnoremap &lt;space&gt;e :action SelectInProjectView&lt;CR&gt;</span><br><span class="line">nnoremap &lt;space&gt;s :action IntroduceVariable&lt;CR&gt;</span><br><span class="line">nnoremap &lt;space&gt;r :action RenameElement&lt;CR&gt;</span><br><span class="line">nnoremap &lt;space&gt;d :action QuickImplementations&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">" 命令模式下 Ni$ &lt;esc&gt; 连续插入N个$, 比如 9ia&lt;esc&gt; 连续插入9个a，这在写分割线的时候很方便</span><br><span class="line">"</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;软件篇&quot;&gt;&lt;a href=&quot;#软件篇&quot; class=&quot;headerlink&quot; title=&quot;软件篇&quot;&gt;&lt;/a&gt;软件篇&lt;/h2&gt;&lt;h3 id=&quot;开发工具类&quot;&gt;&lt;a href=&quot;#开发工具类&quot; class=&quot;headerlink&quot; title=&quot;开发工具类&quot;&gt;&lt;/a&gt;开发工具类&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://oneinstack.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Oneinstack&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Git&lt;/li&gt;
&lt;li&gt;Phpstorm&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/839891627/phpstorm-config&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ideavim 配置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;登录 phpstorm &lt;code&gt;Settings Repository&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#ideavimrc&quot;&gt;.ideavimrc&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Postman&lt;/li&gt;&lt;/ul&gt;
    
    </summary>
    
      <category term="编程" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="phpstorm" scheme="http://yoursite.com/tags/phpstorm/"/>
    
  </entry>
  
  <entry>
    <title>使用PHP压缩并base64编码图片</title>
    <link href="http://yoursite.com/2019/03/29/%E4%BD%BF%E7%94%A8PHP%E5%8E%8B%E7%BC%A9%E5%B9%B6base64%E7%BC%96%E7%A0%81%E5%9B%BE%E7%89%87/"/>
    <id>http://yoursite.com/2019/03/29/使用PHP压缩并base64编码图片/</id>
    <published>2019-03-29T03:44:53.000Z</published>
    <updated>2019-04-03T09:23:55.711Z</updated>
    
    <content type="html"><![CDATA[<blockquote><ul><li>图片 base64 的目的不是减小其大小，而是嵌入在网页中，以此避免浏览器再去对图片发送另一个单独的请求的开销</li><li>图片 base64 后会变大为原来的 4/3</li></ul></blockquote><a id="more"></a><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 图像处理公用类</span></span><br><span class="line"><span class="comment"> * Created by PhpStorm.</span></span><br><span class="line"><span class="comment"> * User: user</span></span><br><span class="line"><span class="comment"> * Date: 2019/1/16</span></span><br><span class="line"><span class="comment"> * Time: 下午4:22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Image</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图片 base64 压缩并编码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $image_file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">base64EncodeImage</span><span class="params">($image_file)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $base64_image = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">if</span> (filesize($image_file) / <span class="number">1024</span> / <span class="number">1024</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// 源文件大于 1m 进行压缩</span></span><br><span class="line">            $tmpImg = <span class="keyword">self</span>::compress($image_file); <span class="comment">// 压缩图片</span></span><br><span class="line">            $base64_image = <span class="string">'data:image/jpeg;base64,'</span> . chunk_split(base64_encode($tmpImg));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $image_info = getimagesize($image_file);</span><br><span class="line">            $image_data = fread(fopen($image_file, <span class="string">'r'</span>), filesize($image_file));</span><br><span class="line">            $base64_image = <span class="string">'data:'</span> . $image_info[<span class="string">'mime'</span>] . <span class="string">';base64,'</span> . chunk_split(base64_encode($image_data));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $base64_image;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图片压缩</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $source string 源文件地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $quality int 压缩质量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $destination string 存放压缩后文件地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> false|string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">compress</span><span class="params">($source, $quality = <span class="number">50</span>, $destination = <span class="string">''</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ini_set(<span class="string">'memory_limit'</span>, <span class="number">-1</span>); <span class="comment">// 以防内存问题</span></span><br><span class="line">        $info = getimagesize($source);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($info[<span class="string">'mime'</span>] == <span class="string">'image/jpeg'</span>) &#123;</span><br><span class="line">            $image = imagecreatefromjpeg($source);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> ($info[<span class="string">'mime'</span>] == <span class="string">'image/gif'</span>) &#123;</span><br><span class="line">            $image = imagecreatefromgif($source);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> ($info[<span class="string">'mime'</span>] == <span class="string">'image/png'</span>) &#123;</span><br><span class="line">            $image = imagecreatefrompng($source);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($destination) &#123;</span><br><span class="line">            <span class="comment">// 如果指定保存文件路径</span></span><br><span class="line">            imagejpeg($image, $destination, $quality);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> $destination;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 直接输出 image stream</span></span><br><span class="line">            ob_start();</span><br><span class="line">            imagejpeg($image, <span class="keyword">null</span>, $quality);</span><br><span class="line">            $data = ob_get_clean();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> $data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$source = <span class="string">'/Users/caojinliang/Downloads/Abstract 2.jpg'</span>;</span><br><span class="line">$img = Image::base64EncodeImage($source);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;img src='$img' width='800' height='600'&gt;"</span>;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;图片 base64 的目的不是减小其大小，而是嵌入在网页中，以此避免浏览器再去对图片发送另一个单独的请求的开销&lt;/li&gt;
&lt;li&gt;图片 base64 后会变大为原来的 4/3&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="编程" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="php" scheme="http://yoursite.com/tags/php/"/>
    
      <category term="图片" scheme="http://yoursite.com/tags/%E5%9B%BE%E7%89%87/"/>
    
  </entry>
  
  <entry>
    <title>在终端中使用代理-proxychains</title>
    <link href="http://yoursite.com/2019/03/12/%E5%9C%A8%E7%BB%88%E7%AB%AF%E4%B8%AD%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86-proxychains/"/>
    <id>http://yoursite.com/2019/03/12/在终端中使用代理-proxychains/</id>
    <published>2019-03-12T10:30:48.000Z</published>
    <updated>2019-03-12T10:38:23.628Z</updated>
    
    <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>命令行默认是不走 <em>代理</em> 的，而例如：<em>brew</em>/<em>composer</em> 这些连接很慢。而 <code>proxychains</code> 则可以在命令行中走代理</p><h2 id="安装并使用"><a href="#安装并使用" class="headerlink" title="安装并使用"></a>安装并使用</h2><ol><li><p>安装</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/rofl0r/proxychains-ng.git</span><br><span class="line"><span class="built_in">cd</span> proxychains-ng</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">cp ./src/proxychains.conf /etc/proxychains.conf</span><br><span class="line"><span class="built_in">cd</span> .. &amp;&amp; rm -rf proxychains-ng</span><br></pre></td></tr></table></figure></li><li><p>编辑 proxychains 配置：<code>vi /etc/proxychains.conf</code>, 将<code>socks4 127.0.0.1 9095</code> 改为 <code>sock5 127.0.0.1 1080</code> (这里视 ss/v2ray 客户端配置情况)</p><blockquote><p>ps: 默认的socks4 127.0.0.1 9095是tor代理，而socks5 127.0.0.1 1080是shadowsocks的代理。</p></blockquote></li><li>使用方法：在需要代理的命令前面加上 <code>proxychains4</code> 即可：<code>proxychains4 wget http://xxx.zip</code><blockquote><p>可以设置 <em>alias</em></p></blockquote></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h2&gt;&lt;p&gt;命令行默认是不走 &lt;em&gt;代理&lt;/em&gt; 的，而例如：&lt;em&gt;brew&lt;/em&gt;/&lt;em&gt;composer&lt;/em&gt; 这些连接很慢。而 &lt;c
      
    
    </summary>
    
      <category term="编程" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="代理" scheme="http://yoursite.com/tags/%E4%BB%A3%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>RSA 签名验证-PHP实现</title>
    <link href="http://yoursite.com/2019/03/01/RSA%20%E7%AD%BE%E5%90%8D%E9%AA%8C%E8%AF%81-PHP%E5%AE%9E%E7%8E%B0/"/>
    <id>http://yoursite.com/2019/03/01/RSA 签名验证-PHP实现/</id>
    <published>2019-03-01T06:37:10.000Z</published>
    <updated>2019-03-12T10:31:01.056Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 数据签名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string|array $data             原始数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string       $privateCertPath  私钥地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string                        签名数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">sign</span><span class="params">($data, $privateCertPath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $data       = is_array($data) ? base64_encode(json_encode($data, JSON_UNESCAPED_SLASHES | JSON_UNESCAPED_UNICODE)) : $data;</span><br><span class="line">    $privateKey = file_get_contents($privateCertPath);</span><br><span class="line">    $privateKey = openssl_pkey_get_private($privateKey);</span><br><span class="line">    $crypted    = <span class="string">''</span>;</span><br><span class="line">    openssl_sign($data, $crypted, $privateKey);</span><br><span class="line">    openssl_free_key($privateKey);</span><br><span class="line"></span><br><span class="line">    $signedData = base64_encode($crypted);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $signedData;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 签名验证</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string|array   $data  原始数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string         $sign  原始数据的签名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string         $publicCertPath  公钥地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">verify</span><span class="params">($data, string $sign, $publicCertPath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $data    = is_array($data) ? base64_encode(json_encode($data, JSON_UNESCAPED_SLASHES | JSON_UNESCAPED_UNICODE)) : $data;</span><br><span class="line">    $pubKey  = file_get_contents($publicCertPath);</span><br><span class="line">    $pubKey  = openssl_pkey_get_public($pubKey); <span class="comment">// 可用返回资源 id</span></span><br><span class="line">    $isValid = (bool)openssl_verify($data, base64_decode($sign), $pubKey);</span><br><span class="line">    openssl_free_key($pubKey);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $isValid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;
      
    
    </summary>
    
      <category term="programming" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="php" scheme="http://yoursite.com/tags/php/"/>
    
      <category term="RSA" scheme="http://yoursite.com/tags/RSA/"/>
    
  </entry>
  
  <entry>
    <title>Navicat for Linux　破解版</title>
    <link href="http://yoursite.com/2018/01/29/%E7%A0%B4%E8%A7%A3%E7%89%88/"/>
    <id>http://yoursite.com/2018/01/29/破解版/</id>
    <published>2018-01-29T02:31:48.000Z</published>
    <updated>2019-03-01T06:31:25.103Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>从同事那边拷过来，记录下安装步骤</p></blockquote><h1 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h1><p>百度云链接：<a href="https://pan.baidu.com/s/1pMi4PWv" target="_blank" rel="noopener">https://pan.baidu.com/s/1pMi4PWv</a></p><h1 id="激活"><a href="#激活" class="headerlink" title="激活"></a>激活</h1><ol><li>修改<code>Navicat.desktop</code>文件里面的路径为实际路径，然后放到　<code>/home/username/.local/share/applications/</code>下</li><li>打开软件，提示激活：</li><li>设置代理：<br> 服务器：00<br> 端口：00<br> 然后点击　<code>ctrl + alt + shift</code>　并点击　<code>激活</code>按钮，选择激活文件 <code>Cracked.win.11.2.13/licese_file</code></li><li>填写激活码：在<code>Cracked.win.11.2.13/SN.txt</code>文件里面</li><li>确认，激活完成!</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;从同事那边拷过来，记录下安装步骤&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;下载&quot;&gt;&lt;a href=&quot;#下载&quot; class=&quot;headerlink&quot; title=&quot;下载&quot;&gt;&lt;/a&gt;下载&lt;/h1&gt;&lt;p&gt;百度云链接：&lt;a href=&quot;http
      
    
    </summary>
    
      <category term="其他" scheme="http://yoursite.com/categories/other/"/>
    
    
  </entry>
  
  <entry>
    <title>element-ui解决表格无限扩大问题</title>
    <link href="http://yoursite.com/2018/01/22/element-ui%E8%A7%A3%E5%86%B3%E8%A1%A8%E6%A0%BC%E6%97%A0%E9%99%90%E6%89%A9%E5%A4%A7%E9%97%AE%E9%A2%98/"/>
    <id>http://yoursite.com/2018/01/22/element-ui解决表格无限扩大问题/</id>
    <published>2018-01-22T09:55:13.000Z</published>
    <updated>2019-03-05T01:06:10.994Z</updated>
    
    <content type="html"><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>element-ui　表格使用的时候，出现宽度无线扩大的情况。<br><img src="https://ws1.sinaimg.cn/large/74f12897gy1g0rn7gxsbvj20sg0sg7id.jpg" alt></p><h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.el-table__header</span>, <span class="selector-class">.el-table__body</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">table-layout</span>: auto <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;问题&quot;&gt;&lt;a href=&quot;#问题&quot; class=&quot;headerlink&quot; title=&quot;问题&quot;&gt;&lt;/a&gt;问题&lt;/h2&gt;&lt;p&gt;element-ui　表格使用的时候，出现宽度无线扩大的情况。&lt;br&gt;&lt;img src=&quot;https://ws1.sinaimg.cn/la
      
    
    </summary>
    
      <category term="编程" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="php" scheme="http://yoursite.com/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>从bz2安装firefox并添加图标</title>
    <link href="http://yoursite.com/2017/11/20/%E4%BB%8Ebz2%E5%AE%89%E8%A3%85firefox%E5%B9%B6%E6%B7%BB%E5%8A%A0%E5%9B%BE%E6%A0%87/"/>
    <id>http://yoursite.com/2017/11/20/从bz2安装firefox并添加图标/</id>
    <published>2017-11-20T07:11:43.000Z</published>
    <updated>2019-03-01T06:31:25.099Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>首先下载最新版，地址：<a href="http://www.firefox.com.cn/download" target="_blank" rel="noopener">http://www.firefox.com.cn/download</a></p></blockquote><ol><li><code>sudo tar -jxvf ~/Firefox-latest-x86_64.tar.bz2 -C ~/App/</code><blockquote><p>习惯在主目录创建<code>App</code>文件夹专门安装软件</p></blockquote></li><li><code>vi ~/.local/share/applications/firefox.desktop</code> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Desktop Entry]  </span><br><span class="line">Name=Firefox 57.0</span><br><span class="line">Comment=firefox</span><br><span class="line">Exec=/home/arvin/App/firefix/firefox</span><br><span class="line">Icon=/home/arvin/firefox/browser/icons/mozicon128.png  </span><br><span class="line">Terminal=false  </span><br><span class="line">Type=Application  </span><br><span class="line">Categories=Application</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;首先下载最新版，地址：&lt;a href=&quot;http://www.firefox.com.cn/download&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://www.firefox.com.cn/download&lt;/a
      
    
    </summary>
    
      <category term="其他" scheme="http://yoursite.com/categories/other/"/>
    
    
      <category term="linux" scheme="http://yoursite.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>PHP实现打包下载</title>
    <link href="http://yoursite.com/2017/11/07/PHP%E5%AE%9E%E7%8E%B0%E6%89%93%E5%8C%85%E4%B8%8B%E8%BD%BD/"/>
    <id>http://yoursite.com/2017/11/07/PHP实现打包下载/</id>
    <published>2017-11-07T06:45:48.000Z</published>
    <updated>2019-03-01T06:31:25.087Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$files   = [</span><br><span class="line">    <span class="string">'https://farm6.staticflickr.com/5584/14985868676_b51baa4071_h.jpg'</span>,</span><br><span class="line">    <span class="string">'https://farm6.staticflickr.com/5591/15008867125_68a8ed88cc_m.jpg'</span></span><br><span class="line">];</span><br><span class="line">$zipname = time(); <span class="comment">// 打包后的文件名</span></span><br><span class="line"></span><br><span class="line">$tmpFile = tempnam(storage_path(), <span class="string">''</span>); <span class="comment">// 临时文件目录</span></span><br><span class="line"></span><br><span class="line">$zip = <span class="keyword">new</span> \ZipArchive();</span><br><span class="line">$zip-&gt;open($tmpFile, \ZipArchive::CREATE);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> ($files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">    $fileContent = file_get_contents($file);</span><br><span class="line">    $zip-&gt;addFromString(basename($file), $fileContent);</span><br><span class="line">&#125;</span><br><span class="line">$zip-&gt;close();</span><br><span class="line"></span><br><span class="line">header(<span class="string">'Content-Type: application/zip'</span>);</span><br><span class="line">header(<span class="string">'Content-disposition: attachment; filename='</span> . $zipname . <span class="string">'.zip'</span>);</span><br><span class="line">header(<span class="string">'Content-Length: '</span> . filesize($tmpFile));</span><br><span class="line">readfile($tmpFile);</span><br><span class="line"></span><br><span class="line">unlink($tmpFile); <span class="comment">// 删除临时文件</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;
      
    
    </summary>
    
      <category term="编程" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="php" scheme="http://yoursite.com/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>后台权限控制的解决方案--RBAC</title>
    <link href="http://yoursite.com/2017/09/29/%E5%90%8E%E5%8F%B0%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-RBAC/"/>
    <id>http://yoursite.com/2017/09/29/后台权限控制的解决方案-RBAC/</id>
    <published>2017-09-29T02:28:37.000Z</published>
    <updated>2019-03-01T06:31:25.099Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>针对后台不同用户，需要控制用户对模块的操作权限，现采用基于用户角色(RBAC,即Role-Based Access Control)的权限管理方案。  </p><p>项目使用 <a href="https://github.com/Zizaco/entrust/" target="_blank" rel="noopener">Zizaco/entrust</a> 扩展包。使用说明参照： <a href="https://github.com/Zizaco/entrust/" target="_blank" rel="noopener">https://github.com/Zizaco/entrust/</a></p><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><ul><li>角色： 根据用户的不同，设置不同的角色。例如：产品管理员（可以配置/拥有产品相关的权限）</li><li>权限： 最底层的原子操作权限。例如：产品编辑的权限、产品添加的权限…</li></ul><a id="more"></a><h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><h3 id="数据字典："><a href="#数据字典：" class="headerlink" title="数据字典："></a>数据字典：</h3><p><strong>permissions:</strong></p><table><thead><tr><th style="text-align:left">字段名</th><th style="text-align:left">类型</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">name</td><td style="text-align:left">string</td><td style="text-align:left">权限码:格式 <code>xxxController@action</code>,系统自动生成</td></tr><tr><td style="text-align:left">parent_id</td><td style="text-align:left">int</td><td style="text-align:left">父级权限id</td></tr><tr><td style="text-align:left">display_name</td><td style="text-align:left">string</td><td style="text-align:left">权限名称</td></tr><tr><td style="text-align:left">description</td><td style="text-align:left">string</td><td style="text-align:left">权限描述</td></tr></tbody></table><p><strong>roles:</strong></p><table><thead><tr><th style="text-align:left">字段名</th><th style="text-align:left">类型</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">name</td><td style="text-align:left">string</td><td style="text-align:left">角色码</td></tr><tr><td style="text-align:left">display_name</td><td style="text-align:left">string</td><td style="text-align:left">角色名称</td></tr><tr><td style="text-align:left">description</td><td style="text-align:left">string</td><td style="text-align:left">角色描述</td></tr></tbody></table><p><strong>permission_role:</strong></p><table><thead><tr><th style="text-align:left">字段名</th><th style="text-align:left">类型</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">role_id</td><td style="text-align:left">int</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">permission_id</td><td style="text-align:left">int</td><td style="text-align:left">&nbsp;</td></tr></tbody></table><p><strong>role_user:</strong></p><table><thead><tr><th style="text-align:left">字段名</th><th style="text-align:left">类型</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">role_id</td><td style="text-align:left">int</td><td style="text-align:left"></td></tr><tr><td style="text-align:left">user_id</td><td style="text-align:left">int</td><td style="text-align:left">&nbsp;</td></tr></tbody></table><h2 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h2><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><ol><li>权限设置<br>权限以目录树的形式展示，直观显示权限的层级关系</li><li>角色的权限分配<br>按权限层级关系的分配，在权限数量比较多的情况下更加方便</li><li>基于权限展示不同的菜单  </li></ol><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><h4 id="初始化数据填充"><a href="#初始化数据填充" class="headerlink" title="初始化数据填充"></a>初始化数据填充</h4><blockquote><ol><li>每次部署执行： <code>php artisan db:seeder --class=RbacSeeder</code></li><li>权限数据由系统<code>database/seeds/RbacSeeder.php</code>文件自动填充，只需在后台修改显示名称即可 </li><li>权限码（permission 的 name 字段）不允许修改，根据 seeder 文件自动生成</li></ol></blockquote><p><code>database/seeds/RbacSeeder.php</code>文件内容如下：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $routes = Route::getRoutes()-&gt;getRoutes();</span><br><span class="line">    <span class="keyword">foreach</span> ($routes <span class="keyword">as</span> $route) &#123;</span><br><span class="line">        $tmpAction = $route-&gt;action[<span class="string">'controller'</span>]; <span class="comment">// 获取系统所有controller</span></span><br><span class="line">        $str       = <span class="string">"App\\Http\\Controllers\\Admin\\"</span>;<span class="comment">// 过滤后台需要控制的模块</span></span><br><span class="line">        <span class="keyword">if</span> (strpos($tmpAction, $str) === <span class="keyword">false</span> || strpos($tmpAction, <span class="string">'create'</span>) || strpos($tmpAction, <span class="string">'edit'</span>)) &#123;</span><br><span class="line">            <span class="comment">// create/store只保留store, edit/update只保留update</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $tmpAction       = str_replace($str, <span class="string">''</span>, $tmpAction);</span><br><span class="line">        $parent          = substr($tmpAction, <span class="number">0</span>, strpos($tmpAction, <span class="string">'@'</span>));<span class="comment">// 初始化层级关系</span></span><br><span class="line">        $data[$parent][] = [</span><br><span class="line">            <span class="string">'name'</span>         =&gt; $tmpAction,</span><br><span class="line">            <span class="string">'display_name'</span> =&gt; <span class="keyword">$this</span>-&gt;getNameByAction($tmpAction)</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">foreach</span> ($data <span class="keyword">as</span> $parent =&gt; $item) &#123;</span><br><span class="line">        $tmp  = [</span><br><span class="line">            <span class="string">'name'</span>         =&gt; $parent,</span><br><span class="line">            <span class="string">'display_name'</span> =&gt; $parent</span><br><span class="line">        ];</span><br><span class="line">        $perm = Permission::where(<span class="string">'name'</span>, $parent)-&gt;first();</span><br><span class="line">        <span class="keyword">if</span> (!$perm) &#123;</span><br><span class="line">            $perm = Permission::create($tmp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">foreach</span> ($item <span class="keyword">as</span> $val) &#123;</span><br><span class="line">            $val[<span class="string">'parent_id'</span>] = $perm-&gt;id;</span><br><span class="line">            <span class="keyword">if</span> (!Permission::where(<span class="string">'name'</span>, $val[<span class="string">'name'</span>])-&gt;first()) &#123;</span><br><span class="line">                Permission::create($val);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;init();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">getNameByAction</span><span class="params">($action)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $action = substr($action, strpos($action, <span class="string">'@'</span>) + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">switch</span> ($action) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'index'</span>:</span><br><span class="line">            $name = <span class="string">'列表'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'update'</span>:</span><br><span class="line">            $name = <span class="string">'更新'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'store'</span>:</span><br><span class="line">            $name = <span class="string">'添加'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'show'</span>:</span><br><span class="line">            $name = <span class="string">'详情'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'destroy'</span>:</span><br><span class="line">            $name = <span class="string">'删除'</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            $name = $action;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化超级管理员(id为1)权限</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $role  = [</span><br><span class="line">        <span class="string">'name'</span>         =&gt; <span class="string">'super_admin'</span>,</span><br><span class="line">        <span class="string">'display_name'</span> =&gt; <span class="string">'超级管理员'</span>,</span><br><span class="line">        <span class="string">'description'</span>  =&gt; <span class="string">'拥有系统所有权限，并且可以分配其他管理员权限'</span></span><br><span class="line">    ];</span><br><span class="line">    $role  = Role::create($role);</span><br><span class="line">    $perms = Permission::all();</span><br><span class="line">    $role-&gt;attachPermissions($perms);</span><br><span class="line">    User::find(<span class="number">1</span>)-&gt;attachRole($role);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>permission最终在数据库的格式如下：(display_name需要到后台页面修改)</p><table><thead><tr><th>ID</th><th>name</th><th>parent_id</th><th>display_name</th><th>description</th></tr></thead><tbody><tr><td>612</td><td>ServiceController</td><td>0</td><td>ServiceController</td><td></td></tr><tr><td>613</td><td>ServiceController@index</td><td>612</td><td>列表</td><td></td></tr><tr><td>614</td><td>ServiceController@store</td><td>612</td><td>添加</td><td></td></tr><tr><td>615</td><td>ServiceController@show</td><td>612</td><td>详情</td><td></td></tr><tr><td>616</td><td>ServiceController@update</td><td>612</td><td>更新</td><td></td></tr><tr><td>617</td><td>ServiceController@destroy</td><td>612</td><td>删除</td><td>&nbsp;</td></tr></tbody></table><h4 id="权限控制"><a href="#权限控制" class="headerlink" title="权限控制"></a>权限控制</h4><h5 id="路由中间件"><a href="#路由中间件" class="headerlink" title="路由中间件"></a>路由中间件</h5><blockquote><p>思路：<code>xxxController@action</code>作为<code>permission</code>的<em>name</em>字段，然后根据<code>request</code>的<em>actionName</em>作判断</p></blockquote><p><code>app/Http/Middleware/Rbac.php</code>：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">($request, Closure $next)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $actionName = $request-&gt;route()-&gt;getActionName();</span><br><span class="line">    $action     = str_replace(<span class="string">"App\\Http\\Controllers\\Admin\\"</span>, <span class="string">''</span>, $actionName);</span><br><span class="line">    $action     = str_replace(<span class="string">"@create"</span>, <span class="string">'@store'</span>, $action);</span><br><span class="line">    $action     = str_replace(<span class="string">"@edit"</span>, <span class="string">'@update'</span>, $action);</span><br><span class="line">    $user       = $request-&gt;user();</span><br><span class="line">    <span class="keyword">if</span> ($user) &#123;</span><br><span class="line">        <span class="comment">// 如果用户已登录</span></span><br><span class="line">        <span class="keyword">if</span> (!$user-&gt;can($action)) &#123;</span><br><span class="line">            $data = $request-&gt;expectsJson() ? [] : view(<span class="string">'errors.403'</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> ErrorResponse::create($data, <span class="number">403</span>)-&gt;setErrorCode(ErrorCode::ERR_NOT_ALLOWED);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $next($request);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="在菜单中控制"><a href="#在菜单中控制" class="headerlink" title="在菜单中控制"></a>在菜单中控制</h5><blockquote><p>对应菜单的<code>path</code>上添加对应<code>xxxController@action</code>的值进行遍历判断</p></blockquote><h2 id="前段"><a href="#前段" class="headerlink" title="前段"></a>前段</h2><h3 id="Permission"><a href="#Permission" class="headerlink" title="Permission"></a>Permission</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;types&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;row&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;col-md-3&quot;&gt;</span><br><span class="line">                &lt;h5&gt;所有类型&lt;/h5&gt;</span><br><span class="line">                &lt;br&gt;</span><br><span class="line">                &lt;el-tree</span><br><span class="line">                        :data=&quot;data&quot;</span><br><span class="line">                        :props=&quot;defaultProps&quot;</span><br><span class="line">                        node-key=&quot;id&quot;</span><br><span class="line">                        accordion</span><br><span class="line">                        :default-expanded-keys=&quot;[0]&quot;</span><br><span class="line">                        @current-change=&quot;show&quot;</span><br><span class="line">                        :expand-on-click-node=&quot;true&quot;&gt;</span><br><span class="line">                &lt;/el-tree&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;col-md-4&quot;&gt;</span><br><span class="line">                &lt;h5&gt;添加&amp;更新&lt;/h5&gt;</span><br><span class="line">                &lt;br&gt;</span><br><span class="line">                &lt;el-form ref=&quot;form&quot; :model=&quot;form&quot; :rules=&quot;rules&quot; label-width=&quot;80px&quot;&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;权限标识&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">                        &lt;el-input :disabled=&quot;true&quot; v-model=&quot;form.name&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;权限名称&quot; prop=&quot;display_name&quot;&gt;</span><br><span class="line">                        &lt;el-input v-model=&quot;form.display_name&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;上级权限&quot; prop=&quot;parent_id&quot;&gt;</span><br><span class="line">                        &lt;el-cascader</span><br><span class="line">                                :options=&quot;options&quot;</span><br><span class="line">                                change-on-select</span><br><span class="line">                                v-model=&quot;selectedOptions&quot;</span><br><span class="line">                                @change=&quot;change&quot;</span><br><span class="line">                        &gt;&lt;/el-cascader&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item label=&quot;描述&quot;&gt;</span><br><span class="line">                        &lt;el-input type=&quot;text&quot; v-model=&quot;form.description&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                    &lt;el-form-item&gt;</span><br><span class="line">                        &lt;!--&lt;el-button v-show=&quot;form.id == null&quot; type=&quot;primary&quot; @click=&quot;add&quot;&gt;添加&lt;/el-button&gt;--&gt;</span><br><span class="line">                        &lt;el-button type=&quot;info&quot; @click=&quot;update&quot;&gt;更新&lt;/el-button&gt;</span><br><span class="line">                        &lt;!--&lt;el-button @click=&quot;clear&quot;&gt;重置表单&lt;/el-button&gt;--&gt;</span><br><span class="line">                        &lt;!--权限的添加，是根据seeder文件自动生成，这里只需要修改名称即可--&gt;</span><br><span class="line">                        &lt;!--&lt;el-button v-show=&quot;form.id != null&quot; type=&quot;warning&quot; @click=&quot;remove&quot;&gt;删除&lt;/el-button&gt;--&gt;</span><br><span class="line">                    &lt;/el-form-item&gt;</span><br><span class="line">                &lt;/el-form&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  import ElementUI from &apos;element-ui&apos;</span><br><span class="line">  import deepcopy from &apos;deepcopy&apos;</span><br><span class="line">  import &apos;element-ui/lib/theme-default/index.css&apos;</span><br><span class="line"></span><br><span class="line">  Vue.use(ElementUI)</span><br><span class="line"></span><br><span class="line">  export default &#123;</span><br><span class="line">    data () &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        data: [],</span><br><span class="line">        options: [],</span><br><span class="line">        defaultProps: &#123;</span><br><span class="line">          children: &apos;children&apos;,</span><br><span class="line">          label: &apos;label&apos;</span><br><span class="line">        &#125;,</span><br><span class="line">        selectedOptions: [0],</span><br><span class="line">        form: &#123;</span><br><span class="line">          id: null,</span><br><span class="line">          display_name: &apos;&apos;,</span><br><span class="line">          parent_id: [],</span><br><span class="line">          description: &apos;&apos;</span><br><span class="line">        &#125;,</span><br><span class="line">        rules: &#123;</span><br><span class="line">          name: [&#123; required: true, message: &apos;请输入权限标识&apos;, trigger: &apos;blur&apos; &#125;],</span><br><span class="line">          display_name: [&#123; required: true, message: &apos;请输入权限名称&apos;, trigger: &apos;blur&apos; &#125;],</span><br><span class="line">          parent_id: [&#123; required: true, message: &apos;请选择上级权限&apos;, trigger: &apos;blur&apos;, type: &apos;array&apos; &#125;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created () &#123;</span><br><span class="line">      this.fetchData()</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      fetchData () &#123;</span><br><span class="line">        this.$http.get(&apos;permission/data&apos;).then((ret) =&gt; &#123;</span><br><span class="line">          this.data = ret.data.data</span><br><span class="line">          let tmp   = deepcopy(this.data) // Js的数组拷贝真是麻烦，引入第三方库</span><br><span class="line">          // 只保留两个层级</span><br><span class="line">          this.options = tmp.map(function(val) &#123;</span><br><span class="line">            if (val.children != undefined) &#123;</span><br><span class="line">              val.children.map(function(v) &#123;</span><br><span class="line">                delete v.children</span><br><span class="line">                return v</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            return val</span><br><span class="line">          &#125;)</span><br><span class="line">          this.clear()</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      change (val) &#123;</span><br><span class="line">        this.form.parent_id = val</span><br><span class="line">      &#125;,</span><br><span class="line">      update () &#123;</span><br><span class="line">        this.$refs[&apos;form&apos;].validate((valid) =&gt; &#123;</span><br><span class="line">          if (!valid) &#123;</span><br><span class="line">            this.$notify(&#123;</span><br><span class="line">              title: &apos;错误&apos;,</span><br><span class="line">              message: &apos;信息填写不完整&apos;,</span><br><span class="line">              type: &apos;error&apos;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.$http.patch(&apos;permission/&apos; + this.form.id, &#123;</span><br><span class="line">              name: this.form.name,</span><br><span class="line">              display_name: this.form.display_name,</span><br><span class="line">              parent_id: this.form.parent_id.pop(),</span><br><span class="line">              description: this.form.desc</span><br><span class="line">            &#125;).then(ret =&gt; &#123;</span><br><span class="line">              if (ret.data.code == 0) &#123;</span><br><span class="line">                this.$notify(&#123;</span><br><span class="line">                  title: &apos;成功&apos;,</span><br><span class="line">                  message: &apos;更新成功&apos;,</span><br><span class="line">                  type: &apos;success&apos;</span><br><span class="line">                &#125;)</span><br><span class="line">                this.fetchData()</span><br><span class="line">              &#125; else &#123;</span><br><span class="line">                this.$notify(&#123;</span><br><span class="line">                  title: &apos;失败&apos;,</span><br><span class="line">                  message: &apos;更新失败&apos;,</span><br><span class="line">                  type: &apos;error&apos;</span><br><span class="line">                &#125;)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      add () &#123;</span><br><span class="line">        this.$refs[&apos;form&apos;].validate((valid) =&gt; &#123;</span><br><span class="line">          if (!valid) &#123;</span><br><span class="line">            this.$notify(&#123;</span><br><span class="line">              title: &apos;错误&apos;,</span><br><span class="line">              message: &apos;信息填写不完整&apos;,</span><br><span class="line">              type: &apos;error&apos;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.$http.post(&apos;permission&apos;, &#123;</span><br><span class="line">              name: this.form.name,</span><br><span class="line">              display_name: this.form.display_name,</span><br><span class="line">              parent_id: this.form.parent_id.pop(),</span><br><span class="line">              description: this.form.desc</span><br><span class="line">            &#125;).then(ret =&gt; &#123;</span><br><span class="line">              this.$notify(&#123;</span><br><span class="line">                title: &apos;成功&apos;,</span><br><span class="line">                message: &apos;添加成功&apos;,</span><br><span class="line">                type: &apos;success&apos;</span><br><span class="line">              &#125;)</span><br><span class="line">              this.fetchData()</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      show (val) &#123;</span><br><span class="line">        this.form.id         = null</span><br><span class="line">        this.selectedOptions = [0]</span><br><span class="line">        this.$http.get(&apos;permission/&apos; + val.id).then(ret =&gt; &#123;</span><br><span class="line">          let item               = ret.data.data</span><br><span class="line">          this.form.id           = item.id</span><br><span class="line">          this.form.name         = item.name</span><br><span class="line">          this.form.display_name = item.display_name</span><br><span class="line">          this.form.description  = item.description</span><br><span class="line">          this.form.parent_id.push(item.parent_id)</span><br><span class="line">          this.selectedOptions.push(item.parent_id)// 这里只支持2级层级，多级层级的话，需要返回父id的父id..</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      clear () &#123;</span><br><span class="line">        this.form.id           = null</span><br><span class="line">        this.form.name         = &apos;&apos;</span><br><span class="line">        this.form.display_name = &apos;&apos;</span><br><span class="line">        this.form.parent_id    = []</span><br><span class="line">        this.form.description  = &apos;&apos;</span><br><span class="line">        this.selectedOptions   = [0]</span><br><span class="line">      &#125;,</span><br><span class="line">      remove () &#123;</span><br><span class="line">        if (this.form.id == null) &#123;</span><br><span class="line">          return false</span><br><span class="line">        &#125;</span><br><span class="line">        this.$http.delete(&apos;permission/&apos; + this.form.id).then(ret =&gt; &#123;</span><br><span class="line">          if (ret.data.code == 0) &#123;</span><br><span class="line">            this.$notify(&#123;</span><br><span class="line">              title: &apos;成功&apos;,</span><br><span class="line">              message: &apos;删除成功&apos;,</span><br><span class="line">              type: &apos;success&apos;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.$notify(&#123;</span><br><span class="line">              title: &apos;错误&apos;,</span><br><span class="line">              message: &apos;删除失败&apos;,</span><br><span class="line">              type: &apos;error&apos;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">          this.fetchData()</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">    .el-cascader &#123;</span><br><span class="line">        width: 100%</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Permission</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PermissionController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="comment">// 渲染blade页面</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getData</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $types       = Permission::select(\DB::raw(<span class="string">'id,name,id as value, parent_id, display_name as label'</span>))-&gt;get()-&gt;toArray();</span><br><span class="line">        $data        = getTree(<span class="number">0</span>, $types);</span><br><span class="line">        $ret[<span class="string">'data'</span>] = [</span><br><span class="line">            [</span><br><span class="line">                <span class="string">'value'</span>    =&gt; <span class="number">0</span>,</span><br><span class="line">                <span class="string">'id'</span>       =&gt; <span class="number">0</span>,</span><br><span class="line">                <span class="string">'label'</span>    =&gt; <span class="string">'根目录'</span>,</span><br><span class="line">                <span class="string">'children'</span> =&gt; $data,</span><br><span class="line">            ],</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;success($ret);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $data[<span class="string">'data'</span>] = Permission::find($id)-&gt;toArray();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;success($data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            $return[<span class="string">'data'</span>] = Permission::create(request()-&gt;all());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;success($return);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (\<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;error(<span class="number">400</span>, <span class="string">'权限已存在'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            $data = request()-&gt;all();</span><br><span class="line">            Permission::where(<span class="string">'id'</span>, $id)-&gt;update($data);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;success([<span class="string">'data'</span> =&gt; <span class="string">'null'</span>]);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (\<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;error(<span class="number">400</span>, <span class="string">'更新失败！'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">`</span><br></pre></td></tr></table></figure><h3 id="Role"><a href="#Role" class="headerlink" title="Role"></a>Role</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; icon=&quot;plus&quot; @click=&quot;needAction = true&quot;&gt;添加角色&lt;/el-button&gt;</span><br><span class="line">        &lt;div style=&quot;margin-bottom:15px&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;el-table :data=&quot;roles&quot; border style=&quot;width: 80%&quot;&gt;</span><br><span class="line">            &lt;el-table-column</span><br><span class="line">                    prop=&quot;name&quot;</span><br><span class="line">                    label=&quot;权限标识&quot;&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column</span><br><span class="line">                    prop=&quot;display_name&quot;</span><br><span class="line">                    label=&quot;角色名称&quot;&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line">            &lt;el-table-column label=&quot;操作&quot;&gt;</span><br><span class="line">                &lt;template scope=&quot;scope&quot;&gt;</span><br><span class="line">                    &lt;el-button size=&quot;small&quot; icon=&quot;edit&quot; @click=&quot;handleEdit(scope.row)&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">                    &lt;el-button size=&quot;small&quot; icon=&quot;share&quot; type=&quot;info&quot; @click=&quot;assign(scope.row.id, scope.row.display_name)&quot;&gt;分配权限&lt;/el-button&gt;</span><br><span class="line">                &lt;/template&gt;</span><br><span class="line">            &lt;/el-table-column&gt;</span><br><span class="line">        &lt;/el-table&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-dialog :title=&quot;title&quot; :visible.sync=&quot;needAction&quot; size=&quot;tiny&quot;&gt;</span><br><span class="line">            &lt;el-form :model=&quot; form&quot; ref=&quot;form&quot; :rules=&quot;rules&quot;&gt;</span><br><span class="line">                &lt;el-form-item label=&quot;角色代码&quot; label-width=&quot;80px&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">                    &lt;el-input v-model=&quot;form.name&quot; auto-complete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">                &lt;/el-form-item&gt;</span><br><span class="line">                &lt;el-form-item label=&quot;角色名称&quot; label-width=&quot;80px&quot; prop=&quot;display_name&quot;&gt;</span><br><span class="line">                    &lt;el-input v-model=&quot;form.display_name&quot; auto-complete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">                &lt;/el-form-item&gt;</span><br><span class="line">                &lt;el-form-item label=&quot;角色描述&quot; label-width=&quot;80px&quot;&gt;</span><br><span class="line">                    &lt;el-input type=&quot;textarea&quot; v-model=&quot;form.description&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">                &lt;/el-form-item&gt;</span><br><span class="line">            &lt;/el-form&gt;</span><br><span class="line">            &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">                &lt;el-button icon=&quot;circle-cross&quot; @click=&quot;cancelAddOrUpdate&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">                &lt;el-button icon=&quot;circle-check&quot; type=&quot;primary&quot; @click=&quot;addOrUpdate&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/el-dialog&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-dialog :title=&quot;assignTitle&quot; :visible.sync=&quot;needAssign&quot; @close=&quot;cancelAssign&quot;&gt;</span><br><span class="line">            &lt;el-row v-for=&quot;(perm, index) in assignForm.perms&quot; :key=&quot;perm.id&quot;&gt;</span><br><span class="line">                &lt;el-checkbox-group v-model=&quot;assignForm.checkedPerms&quot;&gt;</span><br><span class="line">                    &lt;el-checkbox style=&quot;font-weight: bold&quot; :label=&quot;perm.id&quot; @change=&quot;handleCheckAllChange(index,perm.id)&quot;&gt;&#123;&#123; perm.label &#125;&#125;：&lt;/el-checkbox&gt;</span><br><span class="line">                    &lt;div style=&quot;margin: 5px 0;&quot;&gt;&lt;/div&gt;</span><br><span class="line">                    &lt;el-checkbox :class=&quot;&#123;lf: i == 0&#125;&quot; v-for=&quot;(item,i) in perm.children&quot; :label=&quot;item.id&quot; :key=&quot;item.id&quot; @change=&quot;handleCheckedChange(index)&quot;&gt;&#123;&#123;item.label&#125;&#125;&lt;/el-checkbox&gt;</span><br><span class="line">                &lt;/el-checkbox-group&gt;</span><br><span class="line">                &lt;hr&gt;</span><br><span class="line">            &lt;/el-row&gt;</span><br><span class="line">            &lt;el-row&gt;</span><br><span class="line">                &lt;el-button icon=&quot;circle-cross&quot; @click=&quot;cancelAssign&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">                &lt;el-button icon=&quot;circle-check&quot; type=&quot;primary&quot; @click=&quot;doAssign&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">            &lt;/el-row&gt;</span><br><span class="line">        &lt;/el-dialog&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    data () &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        needAction: false,</span><br><span class="line">        needAssign: false,</span><br><span class="line">        id: &apos;&apos;,</span><br><span class="line">        action: &apos;add&apos;,</span><br><span class="line">        form: &#123;</span><br><span class="line">          name: &apos;&apos;,</span><br><span class="line">          display_name: &apos;&apos;,</span><br><span class="line">          description: &apos;&apos;</span><br><span class="line">        &#125;,</span><br><span class="line">        rules: &#123;</span><br><span class="line">          name: [</span><br><span class="line">            &#123; required: true, message: &apos;请输入角色代码&apos;, trigger: &apos;blur&apos; &#125;</span><br><span class="line">          ],</span><br><span class="line">          display_name: [</span><br><span class="line">            &#123; required: true, message: &apos;请输入角色名称&apos;, trigger: &apos;blur&apos; &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        assignTitle: &apos;&apos;,</span><br><span class="line">        assignForm: &#123;</span><br><span class="line">          roleId: &apos;&apos;,</span><br><span class="line">          checkedPerms: [],</span><br><span class="line">          perms: []</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    props: [&apos;roles&apos;],</span><br><span class="line">    computed: &#123;</span><br><span class="line">      title () &#123;</span><br><span class="line">        return this.action == &apos;add&apos; ? &apos;添加&apos; : &apos;编辑&apos;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created () &#123;</span><br><span class="line">      this.getPerms()</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      cancelAddOrUpdate () &#123;</span><br><span class="line">        this.$refs[&apos;form&apos;].resetFields()</span><br><span class="line">        this.form.description = &apos;&apos; // 非必填，reset不了</span><br><span class="line">        this.needAction       = false</span><br><span class="line">        this.action           = &apos;add&apos;</span><br><span class="line">      &#125;,</span><br><span class="line">      addOrUpdate () &#123;</span><br><span class="line">        this.$refs[&apos;form&apos;].validate((valid) =&gt; &#123;</span><br><span class="line">          if (valid) &#123;</span><br><span class="line">            if (this.action == &apos;add&apos;) &#123;</span><br><span class="line">              this.$http.post(&apos;role&apos;, this.form).then(ret =&gt; &#123;</span><br><span class="line">                if (ret.data.code == 400) &#123;</span><br><span class="line">                  this.$message.error(&apos;添加失败！&apos; + ret.data.message)</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                  this.$message.success(&apos;添加成功！&apos;)</span><br><span class="line">                  window.location.reload()</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$http.patch(&apos;role/&apos; + this.id, this.form).then(ret =&gt; &#123;</span><br><span class="line">                if (ret.data.code != 0) &#123;</span><br><span class="line">                  return this.$message.error(&apos;更新失败！&apos;)</span><br><span class="line">                &#125;</span><br><span class="line">                this.$message.success(&apos;更新成功！&apos;)</span><br><span class="line">                this.needAction = false</span><br><span class="line">                this.action     = &apos;add&apos;</span><br><span class="line">                this.roles.map(val =&gt; &#123;</span><br><span class="line">                  if (val.id == this.id) &#123;</span><br><span class="line">                    val.name         = this.form.name</span><br><span class="line">                    val.display_name = this.form.display_name</span><br><span class="line">                    val.description  = this.form.description</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      handleEdit (row) &#123;</span><br><span class="line">        this.form.name         = row.name</span><br><span class="line">        this.form.display_name = row.display_name</span><br><span class="line">        this.form.description  = row.description</span><br><span class="line">        this.id                = row.id</span><br><span class="line">        this.needAction        = true</span><br><span class="line">        this.action            = &apos;edit&apos;</span><br><span class="line">      &#125;,</span><br><span class="line">      getPerms () &#123;</span><br><span class="line">        this.$http.get(&apos;permission/data&apos;).then((ret) =&gt; &#123;</span><br><span class="line">          this.assignForm.perms = ret.data.data[0].children</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      assign (roleId, name) &#123;</span><br><span class="line">        this.$http.get(&apos;role/&apos; + roleId).then(ret =&gt; &#123;</span><br><span class="line">          this.assignForm.checkedPerms = ret.data.data</span><br><span class="line">          this.assignForm.roleId       = roleId</span><br><span class="line">          this.assignTitle             = &apos;当前分配角色：&apos; + name</span><br><span class="line">          this.needAssign              = true</span><br><span class="line">          this.assignForm.perms.map(val =&gt; &#123;</span><br><span class="line">            if (this.assignForm.checkedPerms.indexOf(val.id) &gt;= 0) &#123;</span><br><span class="line">              val.checkAll = true</span><br><span class="line">            &#125;</span><br><span class="line">            return val</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      cancelAssign () &#123;</span><br><span class="line">        this.needAssign              = false</span><br><span class="line">        this.assignForm.roleId       = &apos;&apos;</span><br><span class="line">        this.assignForm.checkedPerms = []</span><br><span class="line">        this.getPerms()</span><br><span class="line">      &#125;,</span><br><span class="line">      doAssign () &#123;</span><br><span class="line">        this.$http.post(&apos;role/&apos; + this.assignForm.roleId + &apos;/permission&apos;, &#123;</span><br><span class="line">          perms: this.assignForm.checkedPerms</span><br><span class="line">        &#125;).then(ret =&gt; &#123;</span><br><span class="line">          if (ret.data.code == 0) &#123;</span><br><span class="line">            this.$message.success(&apos;分配成功！&apos;)</span><br><span class="line">            window.location.reload()</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.$message.error(&apos;分配失败！&apos;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      handleCheckAllChange (index, id) &#123;</span><br><span class="line">        let event    = window.event</span><br><span class="line">        let subPerms = this.assignForm.perms[index].children</span><br><span class="line">        if (event.target.checked) &#123;</span><br><span class="line">          // 全选</span><br><span class="line">          for (let i = 0; i &lt; subPerms.length; i++) &#123;</span><br><span class="line">            // 添加所有子节点</span><br><span class="line">            this.assignForm.checkedPerms.push(subPerms[i].id)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          // 全不选</span><br><span class="line">          let tmp = []</span><br><span class="line">          for (let i = 0; i &lt; subPerms.length; i++) &#123;</span><br><span class="line">            tmp.push(subPerms[i].id)</span><br><span class="line">          &#125;</span><br><span class="line">          this.assignForm.checkedPerms = this.assignForm.checkedPerms.filter(val =&gt; &#123;</span><br><span class="line">            return tmp.indexOf(val) &lt; 0</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      handleCheckedChange (index) &#123;</span><br><span class="line">        let children  = this.assignForm.perms[index].children</span><br><span class="line">        let parent_id = this.assignForm.perms[index].id</span><br><span class="line">        for (let i = 0; i &lt; children.length; i++) &#123;</span><br><span class="line">          let key = this.assignForm.checkedPerms.indexOf(children[i].id)</span><br><span class="line">          let tmp = this.assignForm.checkedPerms.indexOf(parent_id)</span><br><span class="line">          if (key &lt; 0 &amp;&amp; tmp &gt; -1) &#123;</span><br><span class="line">            // 不是全选</span><br><span class="line">            this.assignForm.checkedPerms.splice(tmp, 1)</span><br><span class="line">            return</span><br><span class="line">          &#125; else if (tmp &lt; 0) &#123;</span><br><span class="line">            // 全选</span><br><span class="line">            this.assignForm.checkedPerms.push(parent_id)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    .el-transfer-panel &#123;</span><br><span class="line">        height: 350px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .el-tag &#123;</span><br><span class="line">        margin: 0 2px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .lf &#123;</span><br><span class="line">        margin-left: 50px</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Permission</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">PermissionRole</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Role</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RoleController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $roles = Role::get();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            <span class="string">'template'</span> =&gt; <span class="string">'admin.system.role'</span>,</span><br><span class="line">            <span class="string">'roles'</span>    =&gt; $roles,</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $return[<span class="string">'data'</span>] = PermissionRole::where(<span class="string">'role_id'</span>, $id)-&gt;pluck(<span class="string">'permission_id'</span>)-&gt;toArray();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;success($return);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Role::where(<span class="string">'id'</span>, $id)-&gt;update(request()-&gt;all());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;success([<span class="string">'data'</span> =&gt; <span class="string">'null'</span>]);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (\<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;error(<span class="number">400</span>, <span class="string">'更新失败！'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            $return[<span class="string">'data'</span>] = Role::create(request()-&gt;all());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;success($return);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (\<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;error(<span class="number">400</span>, <span class="string">'角色已存在'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">permission</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            PermissionRole::where(<span class="string">'role_id'</span>, $id)-&gt;delete();<span class="comment">// 先清空权限</span></span><br><span class="line">            $perms = Permission::whereIn(<span class="string">'id'</span>, request()-&gt;get(<span class="string">'perms'</span>))-&gt;get();</span><br><span class="line">            $role  = Role::find($id);</span><br><span class="line">            $role-&gt;attachPermissions($perms);</span><br><span class="line">            \Cache::tags(config(<span class="string">'entrust.permission_role_table'</span>))-&gt;flush();<span class="comment">// 手动清空缓存</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;success([<span class="string">'data'</span> =&gt; <span class="keyword">null</span>]);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (\<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;error(<span class="number">400</span>, <span class="string">'分配失败！'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">data</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $return[<span class="string">'data'</span>] = Role::get()-&gt;toArray();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;success($return);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="User"><a href="#User" class="headerlink" title="User"></a>User</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;el-button type=<span class="string">"primary"</span> icon=<span class="string">"plus"</span> @click=<span class="string">"needAction = true"</span>&gt;添加用户&lt;<span class="regexp">/el-button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div style="margin-bottom:15px"&gt;&lt;/</span>div&gt;</span><br><span class="line">        &lt;el-table :data=<span class="string">"users"</span> border&gt;</span><br><span class="line">            &lt;el-table-column</span><br><span class="line">                    prop=<span class="string">"name"</span></span><br><span class="line">                    label=<span class="string">"用户名"</span>&gt;</span><br><span class="line">            &lt;<span class="regexp">/el-table-column&gt;</span></span><br><span class="line"><span class="regexp">            &lt;el-table-column</span></span><br><span class="line"><span class="regexp">                    prop="email"</span></span><br><span class="line"><span class="regexp">                    label="邮箱"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>el-table-column&gt;</span><br><span class="line">            &lt;el-table-column</span><br><span class="line">                    prop=<span class="string">"roles"</span></span><br><span class="line">                    label=<span class="string">"拥有角色"</span>&gt;</span><br><span class="line">                &lt;template scope=<span class="string">"scope"</span>&gt;</span><br><span class="line">                    &lt;el-tag v-<span class="keyword">for</span>=<span class="string">"(role,index) in scope.row.roles"</span> :key=<span class="string">"index"</span> type=<span class="string">"info"</span> close-transition&gt;&#123;&#123;role.display_name&#125;&#125;&lt;<span class="regexp">/el-tag&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>template&gt;</span><br><span class="line">            &lt;<span class="regexp">/el-table-column&gt;</span></span><br><span class="line"><span class="regexp">            &lt;el-table-column label="操作"&gt;</span></span><br><span class="line"><span class="regexp">                &lt;template scope="scope"&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;el-button size="small" icon="edit" @click="handleEdit(scope.row)"&gt;编辑&lt;/</span>el-button&gt;</span><br><span class="line">                    &lt;el-button size=<span class="string">"small"</span> icon=<span class="string">"share"</span> type=<span class="string">"info"</span> @click=<span class="string">"assign(scope.row.id, scope.row.name)"</span>&gt;分配角色&lt;<span class="regexp">/el-button&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>template&gt;</span><br><span class="line">            &lt;<span class="regexp">/el-table-column&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>el-table&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-dialog :title=<span class="string">"title"</span> :visible.sync=<span class="string">"needAction"</span> size=<span class="string">"tiny"</span> @close=<span class="string">"cancelAddOrUpdate"</span>&gt;</span><br><span class="line">            &lt;el-form :model=<span class="string">" form"</span> ref=<span class="string">"form"</span> :rules=<span class="string">"rules"</span>&gt;</span><br><span class="line">                &lt;el-form-item label=<span class="string">"用户名"</span> label-width=<span class="string">"80px"</span> prop=<span class="string">"name"</span>&gt;</span><br><span class="line">                    &lt;el-input v-model=<span class="string">"form.name"</span> auto-complete=<span class="string">"off"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line">                &lt;el-form-item label="邮箱" label-width="80px" prop="email"&gt;</span><br><span class="line">                    &lt;el-input v-model="form.email" auto-complete="off"&gt;&lt;/el-input&gt;</span><br><span class="line">                &lt;/el-form-item&gt;</span><br><span class="line">                &lt;el-form-item label="密码" label-width="80px" prop="password"&gt;</span><br><span class="line">                    &lt;el-input type="password" v-model="form.password" auto-complete="off"&gt;&lt;/el-input&gt;</span><br><span class="line">                &lt;/el-form-item&gt;</span><br><span class="line">            &lt;/el-form&gt;</span><br><span class="line">            &lt;div slot="footer" class="dialog-footer"&gt;</span><br><span class="line">                &lt;el-button icon="circle-cross" @click="cancelAddOrUpdate"&gt;取 消&lt;/el-button&gt;</span><br><span class="line">                &lt;el-button icon="circle-check" type="primary" @click="addOrUpdate"&gt;确 定&lt;/el-button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/el-dialog&gt;</span><br><span class="line"></span><br><span class="line">        &lt;el-dialog :title="assignTitle" :visible.sync="needAssign" size="tiny"&gt;</span><br><span class="line">            &lt;el-checkbox-group v-model="assignForm.checkedRoles"&gt;</span><br><span class="line">                &lt;ul&gt;</span><br><span class="line">                    &lt;li v-for="role in assignForm.roles" :key="role.id"&gt;</span><br><span class="line">                        &lt;el-checkbox :label="role.id"&gt;&#123;&#123; role.display_name &#125;&#125;&lt;/el-checkbox&gt;</span><br><span class="line">                    &lt;/li&gt;</span><br><span class="line">                &lt;/ul&gt;</span><br><span class="line">            &lt;/el-checkbox-group&gt;</span><br><span class="line">            &lt;div slot="footer" class="dialog-footer"&gt;</span><br><span class="line">                &lt;el-button icon="circle-cross" @click="cancelAssign"&gt;取 消&lt;/el-button&gt;</span><br><span class="line">                &lt;el-button icon="circle-check" type="primary" @click="doAssign"&gt;确 定&lt;/el-button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/el-dialog&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    data () &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        needAction: false,</span><br><span class="line">        needAssign: false,</span><br><span class="line">        id: '',</span><br><span class="line">        action: 'add',</span><br><span class="line">        form: &#123;</span><br><span class="line">          name: '',</span><br><span class="line">          email: '',</span><br><span class="line">          password: ''</span><br><span class="line">        &#125;,</span><br><span class="line">        rules: &#123;</span><br><span class="line">          name: [</span><br><span class="line">            &#123; required: true, message: '请输入用户名', trigger: 'blur' &#125;</span><br><span class="line">          ],</span><br><span class="line">          email: [</span><br><span class="line">            &#123; required: true, message: '请输入邮箱', trigger: 'blur' &#125;</span><br><span class="line">          ],</span><br><span class="line">          password: [</span><br><span class="line">            &#123; required: true, message: '请输入密码', trigger: 'blur' &#125;,</span><br><span class="line">            &#123; min: 3, message: '最小3个字符', trigger: 'blur' &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        assignTitle: '',</span><br><span class="line">        assignForm: &#123;</span><br><span class="line">          userId: '',</span><br><span class="line">          checkedRoles: [],</span><br><span class="line">          roles: []</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    props: ['users'],</span><br><span class="line">    computed: &#123;</span><br><span class="line">      title () &#123;</span><br><span class="line">        return this.action == 'add' ? '添加' : '编辑'</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created () &#123;</span><br><span class="line">      this.getRoles()</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      cancelAddOrUpdate () &#123;</span><br><span class="line">        this.form.name     = ''</span><br><span class="line">        this.form.email    = ''</span><br><span class="line">        this.form.password = ''</span><br><span class="line">        this.needAction    = false</span><br><span class="line">        this.action        = 'add'</span><br><span class="line">      &#125;,</span><br><span class="line">      addOrUpdate () &#123;</span><br><span class="line">        this.$refs['form'].validate((valid) =&gt; &#123;</span><br><span class="line">          if (valid) &#123;</span><br><span class="line">            if (this.action == 'add') &#123;</span><br><span class="line">              this.$http.post('user', this.form).then(ret =&gt; &#123;</span><br><span class="line">                if (ret.data.code == 400) &#123;</span><br><span class="line">                  this.$message.error('添加失败！' + ret.data.message)</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                  this.$message.success('添加成功！')</span><br><span class="line">                  window.location.reload()</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$http.patch('user/' + this.id, this.form).then(ret =&gt; &#123;</span><br><span class="line">                if (ret.data.code != 0) &#123;</span><br><span class="line">                  return this.$message.error('更新失败！')</span><br><span class="line">                &#125;</span><br><span class="line">                this.$message.success('更新成功！')</span><br><span class="line">                this.needAction = false</span><br><span class="line">                this.action     = 'add'</span><br><span class="line">                this.users.map(val =&gt; &#123;</span><br><span class="line">                  if (val.id == this.id) &#123;</span><br><span class="line">                    val.name  = this.form.name</span><br><span class="line">                    val.email = this.form.email</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      handleEdit (row) &#123;</span><br><span class="line">        this.form.name  = row.name</span><br><span class="line">        this.form.email = row.email</span><br><span class="line">        this.id         = row.id</span><br><span class="line">        this.needAction = true</span><br><span class="line">        this.action     = 'edit'</span><br><span class="line">      &#125;,</span><br><span class="line">      getRoles () &#123;</span><br><span class="line">        this.$http.get('role/data').then((ret) =&gt; &#123;</span><br><span class="line">          this.assignForm.roles = ret.data.data</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      assign (userId, name) &#123;</span><br><span class="line">        this.$http.get('user/' + userId).then(ret =&gt; &#123;</span><br><span class="line">          console.log(ret)</span><br><span class="line">          this.assignForm.checkedRoles = ret.data.data</span><br><span class="line">          this.assignForm.userId       = userId</span><br><span class="line">          this.assignTitle             = '当前分配用户：' + name</span><br><span class="line">          this.needAssign              = true</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      cancelAssign () &#123;</span><br><span class="line">        this.needAssign              = false</span><br><span class="line">        this.assignForm.userId       = ''</span><br><span class="line">        this.assignForm.checkedRoles = []</span><br><span class="line">      &#125;,</span><br><span class="line">      doAssign () &#123;</span><br><span class="line">        this.$http.post('user/' + this.assignForm.userId + '/role', &#123;</span><br><span class="line">          roles: this.assignForm.checkedRoles</span><br><span class="line">        &#125;).then(ret =&gt; &#123;</span><br><span class="line">          if (ret.data.code == 0) &#123;</span><br><span class="line">            this.$message.success('分配成功！')</span><br><span class="line">            window.location.reload()</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.$message.error('分配失败！')</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    .el-transfer-panel &#123;</span><br><span class="line">        height: 350px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .el-tag &#123;</span><br><span class="line">        margin: 0 2px;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>UserController.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Admin</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Role</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">RoleUser</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">User</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $users = User::with(<span class="string">'roles'</span>)-&gt;get();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            <span class="string">'template'</span> =&gt; <span class="string">'admin.system.user'</span>,</span><br><span class="line">            <span class="string">'users'</span>    =&gt; $users,</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $data             = request()-&gt;all();</span><br><span class="line">        $data[<span class="string">'password'</span>] = bcrypt($data[<span class="string">'password'</span>]);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            $return[<span class="string">'data'</span>] = User::create($data);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;success($return);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (\<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;error(<span class="number">400</span>, <span class="string">'用户已存在'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            $data             = request()-&gt;all();</span><br><span class="line">            $data[<span class="string">'password'</span>] = bcrypt($data[<span class="string">'password'</span>]);</span><br><span class="line"></span><br><span class="line">            User::where(<span class="string">'id'</span>, $id)-&gt;update($data);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;success([<span class="string">'data'</span> =&gt; <span class="string">'null'</span>]);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (\<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;error(<span class="number">400</span>, <span class="string">'更新失败！'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $user           = User::find($id);</span><br><span class="line">        $return[<span class="string">'data'</span>] = $user-&gt;roles-&gt;pluck(<span class="string">'id'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;success($return);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">role</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            RoleUser::where(<span class="string">'user_id'</span>, $id)-&gt;delete();<span class="comment">// 先清空角色</span></span><br><span class="line">            $roles = Role::whereIn(<span class="string">'id'</span>, request()-&gt;get(<span class="string">'roles'</span>))-&gt;get();</span><br><span class="line">            $user  = User::find($id);</span><br><span class="line"></span><br><span class="line">            $user-&gt;attachRoles($roles);</span><br><span class="line">            \Cache::tags(config(<span class="string">'entrust.role_user_table'</span>))-&gt;flush();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;success([<span class="string">'data'</span> =&gt; <span class="keyword">null</span>]);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (\<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;error(<span class="number">400</span>, <span class="string">'分配失败！'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;针对后台不同用户，需要控制用户对模块的操作权限，现采用基于用户角色(RBAC,即Role-Based Access Control)的权限管理方案。  &lt;/p&gt;
&lt;p&gt;项目使用 &lt;a href=&quot;https://github.com/Zizaco/entrust/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Zizaco/entrust&lt;/a&gt; 扩展包。使用说明参照： &lt;a href=&quot;https://github.com/Zizaco/entrust/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/Zizaco/entrust/&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;概念&quot;&gt;&lt;a href=&quot;#概念&quot; class=&quot;headerlink&quot; title=&quot;概念&quot;&gt;&lt;/a&gt;概念&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;角色： 根据用户的不同，设置不同的角色。例如：产品管理员（可以配置/拥有产品相关的权限）&lt;/li&gt;
&lt;li&gt;权限： 最底层的原子操作权限。例如：产品编辑的权限、产品添加的权限…&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="编程" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="laravel" scheme="http://yoursite.com/tags/laravel/"/>
    
  </entry>
  
  <entry>
    <title>一款给街头卖唱歌手的应用想法</title>
    <link href="http://yoursite.com/2017/09/19/%E4%B8%80%E6%AC%BE%E7%BB%99%E8%A1%97%E5%A4%B4%E5%8D%96%E5%94%B1%E6%AD%8C%E6%89%8B%E7%9A%84%E5%BA%94%E7%94%A8%E6%83%B3%E6%B3%95/"/>
    <id>http://yoursite.com/2017/09/19/一款给街头卖唱歌手的应用想法/</id>
    <published>2017-09-19T07:03:06.000Z</published>
    <updated>2019-03-01T06:31:25.099Z</updated>
    
    <content type="html"><![CDATA[<p>今天在阅读代码的时候，听着音乐，突然有个想法：</p><blockquote><p>给街头卖唱歌手的一款APP</p></blockquote><p>歌手在面前展示二维码，路人可以扫描，上面会有歌手会唱的音乐列表，可供点播（会显示当前的演唱曲目）（点播需要付费，此时可以比较少），演唱完所有扫码的路人可以直接在线打赏。。。</p><blockquote><p>后面慢慢丰富 </p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;今天在阅读代码的时候，听着音乐，突然有个想法：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;给街头卖唱歌手的一款APP&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;歌手在面前展示二维码，路人可以扫描，上面会有歌手会唱的音乐列表，可供点播（会显示当前的演唱曲目）（点播需要付费，此时
      
    
    </summary>
    
      <category term="其他" scheme="http://yoursite.com/categories/other/"/>
    
    
      <category term="idea" scheme="http://yoursite.com/tags/idea/"/>
    
  </entry>
  
  <entry>
    <title>进程、线程解释</title>
    <link href="http://yoursite.com/2017/09/15/%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B%E8%A7%A3%E9%87%8A/"/>
    <id>http://yoursite.com/2017/09/15/进程、线程解释/</id>
    <published>2017-09-15T03:38:39.000Z</published>
    <updated>2019-03-01T06:31:25.103Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>最近在学习<a href="https://wiki.swoole.com/wiki/page/487.html" target="_blank" rel="noopener">swoole</a>的时候，有些前置概念需要了解，看到了阮老师的<a href="http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html" target="_blank" rel="noopener">文章</a>写的很易懂，拿过来作笔记</p></blockquote><ol><li><p>计算机的核心是CPU，它承担了所有的计算任务。它就像一座工厂，时刻在运行。</p></li><li><p>假定工厂的电力有限，一次只能供给一个车间使用。也就是说，一个车间开工的时候，其他车间都必须停工。背后的含义就是，单个CPU一次只能运行一个任务。</p><a id="more"></a></li><li><p>进程就好比工厂的车间，它代表CPU所能处理的单个任务。任一时刻，CPU总是运行一个进程，其他进程处于非运行状态。</p></li><li><p>一个车间里，可以有很多工人。他们协同完成一个任务。</p></li><li><p>线程就好比车间里的工人。一个进程可以包括多个线程。</p></li><li><p>车间的空间是工人们共享的，比如许多房间是每个工人都可以进出的。这象征一个进程的内存空间是共享的，每个线程都可以使用这些共享内存。</p></li><li><p>可是，每间房间的大小不同，有些房间最多只能容纳一个人，比如厕所。里面有人的时候，其他人就不能进去了。这代表一个线程使用某些共享内存时，其他线程必须等它结束，才能使用这一块内存。</p></li><li><p>一个防止他人进入的简单方法，就是门口加一把锁。先到的人锁上门，后到的人看到上锁，就在门口排队，等锁打开再进去。这就叫”互斥锁”（Mutual exclusion，缩写 Mutex），防止多个线程同时读写某一块内存区域。</p></li><li><p>还有些房间，可以同时容纳n个人，比如厨房。也就是说，如果人数大于n，多出来的人只能在外面等着。这好比某些内存区域，只能供给固定数目的线程使用。 </p></li><li><p>这时的解决方法，就是在门口挂n把钥匙。进去的人就取一把钥匙，出来时再把钥匙挂回原处。后到的人发现钥匙架空了，就知道必须在门口排队等着了。这种做法叫做”信号量”（Semaphore），用来保证多个线程不会互相冲突。<br>不难看出，mutex是semaphore的一种特殊情况（n=1时）。也就是说，完全可以用后者替代前者。但是，因为mutex较为简单，且效率高，所以在必须保证资源独占的情况下，还是采用这种设计。</p></li><li><p>操作系统的设计，因此可以归结为三点：<br>（1）以多进程形式，允许多个任务同时运行；<br>（2）以多线程形式，允许单个任务分成不同的部分运行；<br>（3）提供协调机制，一方面防止进程之间和线程之间产生冲突，另一方面允许进程之间和线程之间共享资源。</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;最近在学习&lt;a href=&quot;https://wiki.swoole.com/wiki/page/487.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;swoole&lt;/a&gt;的时候，有些前置概念需要了解，看到了阮老师的&lt;a href=&quot;http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;文章&lt;/a&gt;写的很易懂，拿过来作笔记&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;计算机的核心是CPU，它承担了所有的计算任务。它就像一座工厂，时刻在运行。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;假定工厂的电力有限，一次只能供给一个车间使用。也就是说，一个车间开工的时候，其他车间都必须停工。背后的含义就是，单个CPU一次只能运行一个任务。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;
    
    </summary>
    
      <category term="编程" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="linux" scheme="http://yoursite.com/tags/linux/"/>
    
      <category term="系统" scheme="http://yoursite.com/tags/%E7%B3%BB%E7%BB%9F/"/>
    
  </entry>
  
  <entry>
    <title>深入PHP内核学习笔记</title>
    <link href="http://yoursite.com/2017/09/14/%E6%B7%B1%E5%85%A5PHP%E5%86%85%E6%A0%B8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://yoursite.com/2017/09/14/深入PHP内核学习笔记/</id>
    <published>2017-09-14T02:34:07.000Z</published>
    <updated>2019-03-01T06:31:25.103Z</updated>
    
    <content type="html"><![CDATA[<h3 id="静态变量"><a href="#静态变量" class="headerlink" title="静态变量"></a>静态变量</h3><ul><li>静态全局变量，PHP中的全局变量也可以理解为静态全局变量，因为除非明确unset释放，在程序运行过程中始终存在。</li><li>静态局部变量，也就是在函数内定义的静态变量，函数在执行时对变量的操作会保持到下一次函数被调用。</li><li>静态成员变量，这是在类中定义的静态变量，和实例变量相对应，静态成员变量可以在所有实例中共享</li></ul><blockquote><p>最常见的是静态局部变量及静态成员变量。局部变量只有在函数执行时才会存在。 通常，当一个函数执行完毕，它的<strong>局部变量</strong>的值就已经不存在，而且变量所占据的内存也被释放。 当下一次执行该过程时，它的所有局部变量将重新初始化。如果某个局部变量定义为<strong>静态</strong>的， 则它的值<em>不会在函数调用结束后释放，而是继续保留变量的值</em>。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">t</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> $i = <span class="number">0</span>;</span><br><span class="line">    $i++;</span><br><span class="line">    <span class="keyword">echo</span> $i, <span class="string">' '</span>;</span><br><span class="line">&#125;</span><br><span class="line">t();</span><br><span class="line">t();</span><br><span class="line">t();</span><br><span class="line"><span class="comment">// 1 2 3</span></span><br></pre></td></tr></table></figure></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;静态变量&quot;&gt;&lt;a href=&quot;#静态变量&quot; class=&quot;headerlink&quot; title=&quot;静态变量&quot;&gt;&lt;/a&gt;静态变量&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;静态全局变量，PHP中的全局变量也可以理解为静态全局变量，因为除非明确unset释放，在程序运行过程中始终存在。
      
    
    </summary>
    
      <category term="编程" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="php" scheme="http://yoursite.com/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>无限极分类实现</title>
    <link href="http://yoursite.com/2017/08/07/%E6%97%A0%E9%99%90%E6%9E%81%E5%88%86%E7%B1%BB%E5%AE%9E%E7%8E%B0/"/>
    <id>http://yoursite.com/2017/08/07/无限极分类实现/</id>
    <published>2017-08-07T09:22:41.000Z</published>
    <updated>2019-03-01T06:31:25.102Z</updated>
    
    <content type="html"><![CDATA[<p>数据库中有那么一些数据，<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>:<span class="number">16</span> [</span><br><span class="line">  <span class="number">0</span> =&gt; <span class="keyword">array</span>:<span class="number">3</span> [</span><br><span class="line">    <span class="string">"id"</span> =&gt; <span class="number">1</span></span><br><span class="line">    <span class="string">"parent_id"</span> =&gt; <span class="number">0</span></span><br><span class="line">    <span class="string">"name"</span> =&gt; <span class="string">"电路类"</span></span><br><span class="line">  ]</span><br><span class="line">  <span class="number">1</span> =&gt; <span class="keyword">array</span>:<span class="number">3</span> [</span><br><span class="line">    <span class="string">"id"</span> =&gt; <span class="number">2</span></span><br><span class="line">    <span class="string">"parent_id"</span> =&gt; <span class="number">0</span></span><br><span class="line">    <span class="string">"name"</span> =&gt; <span class="string">"龙头管件类"</span></span><br><span class="line">  ]</span><br><span class="line">  <span class="number">2</span> =&gt; <span class="keyword">array</span>:<span class="number">3</span> [</span><br><span class="line">    <span class="string">"id"</span> =&gt; <span class="number">3</span></span><br><span class="line">    <span class="string">"parent_id"</span> =&gt; <span class="number">0</span></span><br><span class="line">    <span class="string">"name"</span> =&gt; <span class="string">"卫浴洁具类"</span></span><br><span class="line">  ]</span><br><span class="line">  <span class="number">3</span> =&gt; <span class="keyword">array</span>:<span class="number">3</span> [</span><br><span class="line">    <span class="string">"id"</span> =&gt; <span class="number">4</span></span><br><span class="line">    <span class="string">"parent_id"</span> =&gt; <span class="number">0</span></span><br><span class="line">    <span class="string">"name"</span> =&gt; <span class="string">"疏通打孔类"</span></span><br><span class="line">  ]</span><br><span class="line">  <span class="number">4</span> =&gt; <span class="keyword">array</span>:<span class="number">3</span> [</span><br><span class="line">    <span class="string">"id"</span> =&gt; <span class="number">5</span></span><br><span class="line">    <span class="string">"parent_id"</span> =&gt; <span class="number">0</span></span><br><span class="line">    <span class="string">"name"</span> =&gt; <span class="string">"门窗家具五金类"</span></span><br><span class="line">  ]</span><br><span class="line">  <span class="number">5</span> =&gt; <span class="keyword">array</span>:<span class="number">3</span> [</span><br><span class="line">    <span class="string">"id"</span> =&gt; <span class="number">6</span></span><br><span class="line">    <span class="string">"parent_id"</span> =&gt; <span class="number">1</span></span><br><span class="line">    <span class="string">"name"</span> =&gt; <span class="string">"开关插座房屋电路"</span></span><br><span class="line">  ]</span><br><span class="line">  <span class="number">6</span> =&gt; <span class="keyword">array</span>:<span class="number">3</span> [</span><br><span class="line">    <span class="string">"id"</span> =&gt; <span class="number">7</span></span><br><span class="line">    <span class="string">"parent_id"</span> =&gt; <span class="number">1</span></span><br><span class="line">    <span class="string">"name"</span> =&gt; <span class="string">"灯具维修"</span></span><br><span class="line">  ]</span><br><span class="line">  <span class="number">7</span> =&gt; <span class="keyword">array</span>:<span class="number">3</span> [</span><br><span class="line">    <span class="string">"id"</span> =&gt; <span class="number">8</span></span><br><span class="line">    <span class="string">"parent_id"</span> =&gt; <span class="number">6</span></span><br><span class="line">    <span class="string">"name"</span> =&gt; <span class="string">"开关更换维修"</span></span><br><span class="line">  ]</span><br><span class="line">  <span class="number">8</span> =&gt; <span class="keyword">array</span>:<span class="number">3</span> [</span><br><span class="line">    <span class="string">"id"</span> =&gt; <span class="number">9</span></span><br><span class="line">    <span class="string">"parent_id"</span> =&gt; <span class="number">6</span></span><br><span class="line">    <span class="string">"name"</span> =&gt; <span class="string">"空气开关更换维修"</span></span><br><span class="line">  ]</span><br><span class="line">  <span class="number">9</span> =&gt; <span class="keyword">array</span>:<span class="number">3</span> [</span><br><span class="line">    <span class="string">"id"</span> =&gt; <span class="number">10</span></span><br><span class="line">    <span class="string">"parent_id"</span> =&gt; <span class="number">6</span></span><br><span class="line">    <span class="string">"name"</span> =&gt; <span class="string">"家用配电箱维修"</span></span><br><span class="line">  ]</span><br><span class="line">  <span class="number">10</span> =&gt; <span class="keyword">array</span>:<span class="number">3</span> [</span><br><span class="line">    <span class="string">"id"</span> =&gt; <span class="number">11</span></span><br><span class="line">    <span class="string">"parent_id"</span> =&gt; <span class="number">6</span></span><br><span class="line">    <span class="string">"name"</span> =&gt; <span class="string">"墙体插座更换维修"</span></span><br><span class="line">  ]</span><br></pre></td></tr></table></figure></p><p>实现：<br><a id="more"></a><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取树型结构</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $data</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getTree</span><span class="params">($id, $data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $ret = [];</span><br><span class="line">    <span class="keyword">foreach</span> ($data <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($val[<span class="string">'parent_id'</span>] == $id) &#123;</span><br><span class="line">            $tmp = $data[$key];</span><br><span class="line">            <span class="keyword">unset</span>($data[$key]);</span><br><span class="line">            count(getTree($val[<span class="string">'id'</span>], $data)) &amp;&amp; $tmp[<span class="string">'children'</span>] = getTree($val[<span class="string">'id'</span>], $data);</span><br><span class="line">            $ret[$val[<span class="string">'id'</span>]] = $tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">$ret = getTree(<span class="number">0</span>, $data);</span><br></pre></td></tr></table></figure></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">// 输出</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"0"</span>: &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"parent_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"电路类"</span>,</span><br><span class="line">        <span class="attr">"children"</span>: &#123;</span><br><span class="line">            <span class="attr">"6"</span>: &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="number">6</span>,</span><br><span class="line">                <span class="attr">"parent_id"</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">"name"</span>: <span class="string">"开关插座房屋电路"</span>,</span><br><span class="line">                <span class="attr">"children"</span>: &#123;</span><br><span class="line">                    <span class="attr">"8"</span>: &#123;</span><br><span class="line">                        <span class="attr">"id"</span>: <span class="number">8</span>,</span><br><span class="line">                        <span class="attr">"parent_id"</span>: <span class="number">6</span>,</span><br><span class="line">                        <span class="attr">"name"</span>: <span class="string">"开关更换维修"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"9"</span>: &#123;</span><br><span class="line">                        <span class="attr">"id"</span>: <span class="number">9</span>,</span><br><span class="line">                        <span class="attr">"parent_id"</span>: <span class="number">6</span>,</span><br><span class="line">                        <span class="attr">"name"</span>: <span class="string">"空气开关更换维修"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"10"</span>: &#123;</span><br><span class="line">                        <span class="attr">"id"</span>: <span class="number">10</span>,</span><br><span class="line">                        <span class="attr">"parent_id"</span>: <span class="number">6</span>,</span><br><span class="line">                        <span class="attr">"name"</span>: <span class="string">"家用配电箱维修"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"11"</span>: &#123;</span><br><span class="line">                        <span class="attr">"id"</span>: <span class="number">11</span>,</span><br><span class="line">                        <span class="attr">"parent_id"</span>: <span class="number">6</span>,</span><br><span class="line">                        <span class="attr">"name"</span>: <span class="string">"墙体插座更换维修"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"12"</span>: &#123;</span><br><span class="line">                        <span class="attr">"id"</span>: <span class="number">12</span>,</span><br><span class="line">                        <span class="attr">"parent_id"</span>: <span class="number">6</span>,</span><br><span class="line">                        <span class="attr">"name"</span>: <span class="string">"地插更换维修"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"13"</span>: &#123;</span><br><span class="line">                        <span class="attr">"id"</span>: <span class="number">13</span>,</span><br><span class="line">                        <span class="attr">"parent_id"</span>: <span class="number">6</span>,</span><br><span class="line">                        <span class="attr">"name"</span>: <span class="string">"综合布线维修"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"14"</span>: &#123;</span><br><span class="line">                        <span class="attr">"id"</span>: <span class="number">14</span>,</span><br><span class="line">                        <span class="attr">"parent_id"</span>: <span class="number">6</span>,</span><br><span class="line">                        <span class="attr">"name"</span>: <span class="string">"其他电路检修"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"7"</span>: &#123;</span><br><span class="line">                <span class="attr">"id"</span>: <span class="number">7</span>,</span><br><span class="line">                <span class="attr">"parent_id"</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="attr">"name"</span>: <span class="string">"灯具维修"</span>,</span><br><span class="line">                <span class="attr">"children"</span>: &#123;</span><br><span class="line">                    <span class="attr">"15"</span>: &#123;</span><br><span class="line">                        <span class="attr">"id"</span>: <span class="number">15</span>,</span><br><span class="line">                        <span class="attr">"parent_id"</span>: <span class="number">7</span>,</span><br><span class="line">                        <span class="attr">"name"</span>: <span class="string">"灯具检测维修"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"16"</span>: &#123;</span><br><span class="line">                        <span class="attr">"id"</span>: <span class="number">16</span>,</span><br><span class="line">                        <span class="attr">"parent_id"</span>: <span class="number">7</span>,</span><br><span class="line">                        <span class="attr">"name"</span>: <span class="string">"普通灯具、吊灯、造型灯更换维修"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"1"</span>: &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"parent_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"龙头管件类"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"2"</span>: &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="attr">"parent_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"卫浴洁具类"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"3"</span>: &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">4</span>,</span><br><span class="line">        <span class="attr">"parent_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"疏通打孔类"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"4"</span>: &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">"parent_id"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"name"</span>: <span class="string">"门窗家具五金类"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;数据库中有那么一些数据，&lt;br&gt;&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;array&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;16&lt;/span&gt; [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; =&amp;gt; &lt;span class=&quot;keyword&quot;&gt;array&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;parent_id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;电路类&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; =&amp;gt; &lt;span class=&quot;keyword&quot;&gt;array&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;parent_id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;龙头管件类&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt; =&amp;gt; &lt;span class=&quot;keyword&quot;&gt;array&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;parent_id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;卫浴洁具类&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; =&amp;gt; &lt;span class=&quot;keyword&quot;&gt;array&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;parent_id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;疏通打孔类&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt; =&amp;gt; &lt;span class=&quot;keyword&quot;&gt;array&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;parent_id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;门窗家具五金类&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt; =&amp;gt; &lt;span class=&quot;keyword&quot;&gt;array&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;parent_id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;开关插座房屋电路&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt; =&amp;gt; &lt;span class=&quot;keyword&quot;&gt;array&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;parent_id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;灯具维修&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;number&quot;&gt;7&lt;/span&gt; =&amp;gt; &lt;span class=&quot;keyword&quot;&gt;array&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;parent_id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;开关更换维修&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt; =&amp;gt; &lt;span class=&quot;keyword&quot;&gt;array&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;parent_id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;空气开关更换维修&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;number&quot;&gt;9&lt;/span&gt; =&amp;gt; &lt;span class=&quot;keyword&quot;&gt;array&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;parent_id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;家用配电箱维修&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt; =&amp;gt; &lt;span class=&quot;keyword&quot;&gt;array&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;parent_id&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;string&quot;&gt;&quot;墙体插座更换维修&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;实现：&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="编程" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="php" scheme="http://yoursite.com/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>composer安装版本问题</title>
    <link href="http://yoursite.com/2017/08/07/composer%E5%AE%89%E8%A3%85%E7%89%88%E6%9C%AC%E9%97%AE%E9%A2%98/"/>
    <id>http://yoursite.com/2017/08/07/composer安装版本问题/</id>
    <published>2017-08-07T02:10:35.000Z</published>
    <updated>2019-03-01T06:31:25.089Z</updated>
    
    <content type="html"><![CDATA[<p>进行laravel的数据迁移的时候，对修改字段类型，需要安装 <code>composer install doctrine/dbal</code>,但是遇到以下问题：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Problem 1</span><br><span class="line">   - Installation request for doctrine/dbal v2.6.1 -&gt; satisfiable by doctrine/dbal[v2.6.1].</span><br><span class="line">   - doctrine/dbal v2.6.1 requires php ^7.1 -&gt; your PHP version (7.0.16) does not satisfy that requirement.</span><br><span class="line"> Problem 2</span><br><span class="line">   - doctrine/instantiator 1.1.0 requires php ^7.1 -&gt; your PHP version (7.0.16) does not satisfy that requirement.</span><br><span class="line">   - doctrine/instantiator 1.1.0 requires php ^7.1 -&gt; your PHP version (7.0.16) does not satisfy that requirement.</span><br><span class="line">   - Installation request for doctrine/instantiator 1.1.0 -&gt; satisfiable by doctrine/instantiator[1.1.0].</span><br></pre></td></tr></table></figure></p><p><strong>解决如下：</strong><br>    <code>composer install doctrine/dbal --ignore-platform-reqs</code>  </p><p><strong>如果更新，则：</strong><br>    <code>composer update --ignore-platform-reqs</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;进行laravel的数据迁移的时候，对修改字段类型，需要安装 &lt;code&gt;composer install doctrine/dbal&lt;/code&gt;,但是遇到以下问题：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td cl
      
    
    </summary>
    
      <category term="编程" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="-php - composer" scheme="http://yoursite.com/tags/php-composer/"/>
    
  </entry>
  
  <entry>
    <title>navicat破解方法</title>
    <link href="http://yoursite.com/2017/07/17/navicat%E7%A0%B4%E8%A7%A3%E6%96%B9%E6%B3%95/"/>
    <id>http://yoursite.com/2017/07/17/navicat破解方法/</id>
    <published>2017-07-17T01:34:48.000Z</published>
    <updated>2019-03-01T06:31:25.098Z</updated>
    
    <content type="html"><![CDATA[<p>安装后，在<code>/home/username/.navicat</code>文件夹下有一个system.reg/user.reg文件,删除后即可.<br>把此文件删除后，下次启动navicat 会重新生成此文件，30天试用期会按新的时间开始计算。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;安装后，在&lt;code&gt;/home/username/.navicat&lt;/code&gt;文件夹下有一个system.reg/user.reg文件,删除后即可.&lt;br&gt;把此文件删除后，下次启动navicat 会重新生成此文件，30天试用期会按新的时间开始计算。&lt;/p&gt;

      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>gitlab搭建笔记</title>
    <link href="http://yoursite.com/2017/07/13/gitlab%E6%90%AD%E5%BB%BA%E7%AC%94%E8%AE%B0/"/>
    <id>http://yoursite.com/2017/07/13/gitlab搭建笔记/</id>
    <published>2017-07-13T07:20:21.000Z</published>
    <updated>2019-07-13T03:18:39.151Z</updated>
    
    <content type="html"><![CDATA[<h3 id="安装篇-docker安装"><a href="#安装篇-docker安装" class="headerlink" title="安装篇(docker安装)"></a>安装篇(docker安装)</h3><ol><li><code>sudo apt install docker</code></li><li><code>sudo apt install docker-compose</code><a id="more"></a></li><li><p>新建 docker配置文件 <code>docker-compose.yml</code>,配置如下：  </p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">web:</span></span><br><span class="line"><span class="attr">  image:</span> <span class="string">'gitlab/gitlab-ce:latest'</span></span><br><span class="line"><span class="attr">  restart:</span> <span class="string">always</span></span><br><span class="line"><span class="attr">  hostname:</span> <span class="string">'gitlab.example.com'</span> <span class="comment"># 此处填写服务器的 ip</span></span><br><span class="line"><span class="attr">  environment:</span></span><br><span class="line"><span class="attr">    GITLAB_OMNIBUS_CONFIG:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      external_url 'https://gitlab.example.com' # 同理，填写 ip</span></span><br><span class="line"><span class="string">      # Add any other gitlab.rb configuration here, each on its own line</span></span><br><span class="line"><span class="string"></span><span class="attr">  ports:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">'80:80'</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">'443:443'</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">'22:22'</span> <span class="comment"># 格式为： 本机端口：docker端口， 如果后面运行端口被占用，可以修改此处配置</span></span><br><span class="line"><span class="attr">  volumes:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">'/srv/gitlab/config:/etc/gitlab'</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">'/srv/gitlab/logs:/var/log/gitlab'</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">'/srv/gitlab/data:/var/opt/gitlab'</span></span><br></pre></td></tr></table></figure></li><li><p>下载启动gitlab镜像：<code>docker-compose up -d</code> （不加 <code>-d</code> 可以查看启动过程日志）</p></li><li>启动完毕即可以登录上面配置的 ip地址访问gitlab web端(默认端口 80)</li></ol><h3 id="配置篇"><a href="#配置篇" class="headerlink" title="配置篇"></a>配置篇</h3><h4 id="去除注册功能"><a href="#去除注册功能" class="headerlink" title="去除注册功能"></a>去除注册功能</h4><ol><li>这个可以直接在web端，通过管理员身份进行设置<br>关闭<code>Sign-up enabled</code> 选项即可</li></ol><h4 id="修改docker配置"><a href="#修改docker配置" class="headerlink" title="修改docker配置　　"></a>修改docker配置　　</h4><ol><li>首先运行：<code>docker ps</code> 查看容器名称   </li><li>修改配置：<code>docker exec -it 容器名称  vi /etc/gitlab/gitlab.rb</code>  </li><li>重载配置：<code>docker exec -it 容器名称  gitlab-ctl reconfigure</code>  </li></ol><h4 id="配置通知邮箱-这里采用smtp邮箱："><a href="#配置通知邮箱-这里采用smtp邮箱：" class="headerlink" title="配置通知邮箱,这里采用smtp邮箱："></a>配置通知邮箱,这里采用<em>smtp</em>邮箱：</h4><blockquote><p>smtp相关部分，例如配置qq、163等，参照 <a href="https://docs.gitlab.com.cn/omnibus/settings/smtp.html#outlook" target="_blank" rel="noopener">这里</a>  </p></blockquote><p>outlook邮箱如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gitlab_rails[&apos;smtp_enable&apos;] = true</span><br><span class="line">gitlab_rails[&apos;smtp_address&apos;] = &quot;smtp-mail.outlook.com&quot;</span><br><span class="line">gitlab_rails[&apos;smtp_port&apos;] = 587</span><br><span class="line">gitlab_rails[&apos;smtp_user_name&apos;] = &quot;username@outlook.com&quot;</span><br><span class="line">gitlab_rails[&apos;smtp_password&apos;] = &quot;password&quot;</span><br><span class="line">gitlab_rails[&apos;smtp_domain&apos;] = &quot;smtp-mail.outlook.com&quot;</span><br><span class="line">gitlab_rails[&apos;smtp_authentication&apos;] = &quot;login&quot;</span><br><span class="line">gitlab_rails[&apos;smtp_enable_starttls_auto&apos;] = true</span><br><span class="line">gitlab_rails[&apos;smtp_openssl_verify_mode&apos;] = &apos;peer&apos;</span><br></pre></td></tr></table></figure></p><h4 id="验证邮箱是否配置成功："><a href="#验证邮箱是否配置成功：" class="headerlink" title="验证邮箱是否配置成功："></a>验证邮箱是否配置成功：</h4><ol><li>运行：<code>docker exec -it 容器名称  gitlab-rails console</code>  <blockquote><p>irb(main):003:0&gt; Notify.test_email(<a href="mailto:&#39;destination_email@address.com" target="_blank" rel="noopener">&#39;destination_email@address.com</a>‘, ‘Message Subject’, ‘Message Body’).deliver_now</p></blockquote></li></ol><h4 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h4><h6 id="docker相关错误"><a href="#docker相关错误" class="headerlink" title="docker相关错误"></a>docker相关错误</h6><p><img src="/2017/07/13/gitlab搭建笔记/docker-compose.png" alt></p><h6 id="outlook邮箱配置错误"><a href="#outlook邮箱配置错误" class="headerlink" title="outlook邮箱配置错误"></a>outlook邮箱配置错误</h6><ul><li>unable to send and recivie emails error code: 535 5.0.0 Authentication Failed code(535)<br><strong>解决：</strong> <a href="https://answers.microsoft.com/en-us/outlook_com/forum/oemail-osend/unable-to-send-and-recivie-emails-error-code-535/15db149b-403a-4de7-8ef1-6cdeda9327de" target="_blank" rel="noopener">https://answers.microsoft.com/en-us/outlook_com/forum/oemail-osend/unable-to-send-and-recivie-emails-error-code-535/15db149b-403a-4de7-8ef1-6cdeda9327de</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;安装篇-docker安装&quot;&gt;&lt;a href=&quot;#安装篇-docker安装&quot; class=&quot;headerlink&quot; title=&quot;安装篇(docker安装)&quot;&gt;&lt;/a&gt;安装篇(docker安装)&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;code&gt;sudo apt install docker&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sudo apt install docker-compose&lt;/code&gt;&lt;/li&gt;&lt;/ol&gt;
    
    </summary>
    
      <category term="编程" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="gitlab" scheme="http://yoursite.com/tags/gitlab/"/>
    
  </entry>
  
  <entry>
    <title>设计模式-- 单例模式</title>
    <link href="http://yoursite.com/2017/07/04/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2017/07/04/设计模式之单例模式/</id>
    <published>2017-07-04T10:05:37.000Z</published>
    <updated>2019-03-01T06:31:25.103Z</updated>
    
    <content type="html"><![CDATA[<h4 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a><a href="http://blog.csdn.net/LoveLion/article/details/7420883" target="_blank" rel="noopener">单例模式</a></h4><blockquote><p>确保某一个类只有一个实例，而且自行实例化并向整个系统提供这个实例，这个类称为单例类，它提供全局访问的方法。单例模式是一种对象创建型模式。</p></blockquote><a id="more"></a><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> $instance;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 私有 保证不能通过 new 来实例化</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 私有 保证不能复制或克隆</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">clone</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 唯一对外获取实例方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> funcion getInstance () &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>::$instance === <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>::$instance = <span class="keyword">new</span> Foo;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>::$intance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Foo::getInstance(); <span class="comment">// 因为不能 new，所以成员变量 $instance 是静态的</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;单例模式&quot;&gt;&lt;a href=&quot;#单例模式&quot; class=&quot;headerlink&quot; title=&quot;单例模式&quot;&gt;&lt;/a&gt;&lt;a href=&quot;http://blog.csdn.net/LoveLion/article/details/7420883&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;单例模式&lt;/a&gt;&lt;/h4&gt;&lt;blockquote&gt;
&lt;p&gt;确保某一个类只有一个实例，而且自行实例化并向整个系统提供这个实例，这个类称为单例类，它提供全局访问的方法。单例模式是一种对象创建型模式。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="编程" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="设计模式" scheme="http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>RMQ学习笔记</title>
    <link href="http://yoursite.com/2017/07/03/RMQ%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://yoursite.com/2017/07/03/RMQ学习笔记/</id>
    <published>2017-07-03T03:28:33.000Z</published>
    <updated>2019-03-01T06:31:25.087Z</updated>
    
    <content type="html"><![CDATA[<h4 id="路由绑定以及消息路由"><a href="#路由绑定以及消息路由" class="headerlink" title="路由绑定以及消息路由"></a>路由绑定以及消息路由</h4><p><img src="/2017/07/03/RMQ学习笔记/./rmq.jpg" alt="rmq"></p><a id="more"></a><h5 id="发布者："><a href="#发布者：" class="headerlink" title="发布者："></a>发布者：</h5><div id="flowchart-0" class="flow-chart"></div><h5 id="消费者："><a href="#消费者：" class="headerlink" title="消费者："></a>消费者：</h5><p><div id="flowchart-1" class="flow-chart"></div></p><h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><ol><li>basic.consume  <blockquote><p>持续订阅  </p></blockquote></li><li>basic.get  <blockquote><p>获取一条（会产生订阅/取消订阅的动作，所以不要用循环<code>basic.get</code>来取代<code>basic.consume</code>）  </p></blockquote></li><li>queue.declare  <blockquote><p>声明队列，需要传入队列名称，如果不传，则会自动随机生成一个队列名称。<br>如果队列名称已经存在，则不会再重复生成，而是返回 true<br>参数：  </p><ul><li>exclusive 若为<code>true</code>,则队列变成<em>私有</em></li><li>auto-delete 若为<code>true</code>, 则当最后一个消费者取消订阅时，队列会自动删除。 可以配合<code>exclusive</code>来使用  </li><li>passive 用来检测队列是否存在。若为<code>true</code>,则会根据队列是否存在，返回 成功/错误，而不是生成新的队列</li></ul></blockquote></li><li>basic_publish ($msg, $exchange, $routing_key)<blockquote><p>根据 <em>routing_key</em> 绑定消息到 <em>$exchange</em>上的queue上</p></blockquote></li><li>queue_bind($queue, $exchange, $routing_key)</li></ol><h4 id="消息持久化"><a href="#消息持久化" class="headerlink" title="消息持久化"></a>消息持久化</h4><blockquote><p>通过将消息写入磁盘日志来持久化<br>但是持久化会带来性能上的问题，因为写入硬盘要比写入内存慢得多,所以不建议所有消息都持久化</p><ol><li>队列和交换器的<code>durable</code>属性设置为<code>true</code></li><li>发送到持久化的交换器</li><li>到达持久化的队列</li></ol></blockquote><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><p><strong><a href="https://github.com/839891627/rmq-notes" target="_blank" rel="noopener">代码笔记</a></strong></p><p><script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script><textarea id="flowchart-0-code" style="display: none">st=>start: 开始e=>end: 结束op1=>operation: 连接到RabbitMQop2=>operation: 获取信道 channelop3=>operation: 声明交换器 exchangeop4=>operation: 创建消息op5=>operation: 发布消息op6=>operation: 关闭信道op7=>operation: 关闭连接st->op1->op2->op3->op4->op5->op6->op7->e</textarea><textarea id="flowchart-0-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script><textarea id="flowchart-1-code" style="display: none">st=>start: 开始e=>end: 结束op1=>operation: 连接到RabbitMQop2=>operation: 获取信道 channelop3=>operation: 声明交换器 exchangeop4=>operation: 声明队列op5=>operation: 把队列和交换器绑定起来op6=>operation: 消费消息op7=>operation: 关闭信道op8=>operation: 关闭连接st->op1->op2->op3->op4->op5->op6->op7->e</textarea><textarea id="flowchart-1-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-1-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-1-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-1", options);</script></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;路由绑定以及消息路由&quot;&gt;&lt;a href=&quot;#路由绑定以及消息路由&quot; class=&quot;headerlink&quot; title=&quot;路由绑定以及消息路由&quot;&gt;&lt;/a&gt;路由绑定以及消息路由&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;/2017/07/03/RMQ学习笔记/./rmq.jpg&quot; alt=&quot;rmq&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="编程" scheme="http://yoursite.com/categories/programming/"/>
    
    
      <category term="RMQ" scheme="http://yoursite.com/tags/RMQ/"/>
    
      <category term="消息队列" scheme="http://yoursite.com/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>多PC同步hexo</title>
    <link href="http://yoursite.com/2017/06/30/%E5%A4%9APC%E5%90%8C%E6%AD%A5hexo/"/>
    <id>http://yoursite.com/2017/06/30/多PC同步hexo/</id>
    <published>2017-06-30T07:48:10.000Z</published>
    <updated>2019-03-01T06:31:25.102Z</updated>
    
    <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>由于可能同时在公司和家中写文章，所以hexo同步是个问题，现记录解决方案</p><h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><h3 id="首次操作"><a href="#首次操作" class="headerlink" title="首次操作"></a>首次操作</h3><ol><li>创建 repo: <code>username.github.io</code><a id="more"></a></li><li>创建两个分之<ul><li>hexo: <strong>设置为默认分支</strong> （存 源文件）</li><li>master: 存生成的静态页面</li></ul></li><li>本地安装hexo:<blockquote><ol><li><code>npm install hexo -g</code></li><li><code>hexo init</code></li><li><code>npm install</code></li><li><code>npm install hexo-deployer-git -S</code></li><li>修改 <em>_config.yml</em> <em>deploy</em> <code>branch: master</code></li></ol></blockquote></li></ol><h3 id="后期同步操作"><a href="#后期同步操作" class="headerlink" title="后期同步操作"></a>后期同步操作</h3><blockquote><p>在仓库已经建好后</p><ol><li><code>git clone git@github.com:username/username.github.io.git</code></li><li><code>cd username.github.io</code></li><li><code>npm install</code></li></ol></blockquote><h3 id="写文章"><a href="#写文章" class="headerlink" title="写文章"></a>写文章</h3><blockquote><p>以下操作在 <strong>hexo</strong> 分支下</p><ol><li><code>git add .</code></li><li><code>git commit -m &#39;message&#39;</code></li><li><code>git push origin hexo</code> 直到这里，是同步的源文件</li><li><code>sudo hexo g -d</code> 部署静态文件</li><li><em>done</em></li></ol></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h2&gt;&lt;p&gt;由于可能同时在公司和家中写文章，所以hexo同步是个问题，现记录解决方案&lt;/p&gt;
&lt;h2 id=&quot;解决&quot;&gt;&lt;a href=&quot;#解决&quot; class=&quot;headerlink&quot; title=&quot;解决&quot;&gt;&lt;/a&gt;解决&lt;/h2&gt;&lt;h3 id=&quot;首次操作&quot;&gt;&lt;a href=&quot;#首次操作&quot; class=&quot;headerlink&quot; title=&quot;首次操作&quot;&gt;&lt;/a&gt;首次操作&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;创建 repo: &lt;code&gt;username.github.io&lt;/code&gt;&lt;/li&gt;&lt;/ol&gt;
    
    </summary>
    
      <category term="其他" scheme="http://yoursite.com/categories/other/"/>
    
    
      <category term="hexo" scheme="http://yoursite.com/tags/hexo/"/>
    
  </entry>
  
</feed>
